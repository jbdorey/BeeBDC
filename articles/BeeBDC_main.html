<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BeeBDC vignette • BeeBDC</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="BeeBDC vignette">
<meta property="og:description" content="BeeBDC">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">BeeBDC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-book"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/BeeBDC_main.html">BeeBDC vignette</a>
    </li>
    <li>
      <a href="../articles/BeeBDC_main.html#time">TEST_time</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jbdorey/BeeBDC/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>BeeBDC vignette</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jbdorey/BeeBDC/blob/HEAD/vignettes/BeeBDC_main.Rmd" class="external-link"><code>vignettes/BeeBDC_main.Rmd</code></a></small>
      <div class="hidden name"><code>BeeBDC_main.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="script-preparation">0.0 Script preparation<a class="anchor" aria-label="anchor" href="#script-preparation"></a>
</h2>
<div class="section level3">
<h3 id="working-directory">0.1 Working directory<a class="anchor" aria-label="anchor" href="#working-directory"></a>
</h3>
<p>Choose the path to the root folder in which all other folders can be
found.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RootPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"/your/path/here"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># Create the working directory in the RootPath if it doesn't exist already</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">RootPath</span>, <span class="st">"/Data_acquisition_workflow"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">RootPath</span>, <span class="st">"/Data_acquisition_workflow"</span><span class="op">)</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span>  <span class="co"># Set the working directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">RootPath</span>,<span class="st">"/Data_acquisition_workflow"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>For the first time that you run BeeBDC, and if you want to use the
renv package to manage your packages, you can install renv…</p>
<pre><code><span>        <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"renv"</span><span class="op">)</span></span></code></pre>
<p>and then initialise renv the project.</p>
<pre><code><span>        <span class="fu">renv</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/renv/reference/init.html" class="external-link">init</a></span><span class="op">(</span>project <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">RootPath</span>,<span class="st">"/Data_acquisition_workflow"</span><span class="op">)</span><span class="op">)</span> </span></code></pre>
<p>If you have already initialised a project, you can instead just
activate it.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">renv</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/renv/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span>project <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">RootPath</span>,<span class="st">"/Data_acquisition_workflow"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="install-packages-if-needed">0.2 Install packages (if needed)<a class="anchor" aria-label="anchor" href="#install-packages-if-needed"></a>
</h3>
<p>You may need to install gdal on your computer. This can be done on a
Mac by using Homebrew in the terminal and the command “brew install
gdal”.</p>
<p>To start out, you will need to install <strong>BiocManager</strong>,
<strong>devtools</strong>, <strong>ComplexHeatmap</strong>, and
<strong>rnaturalearthhires</strong> to then install and fully use
BeeBDC.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://bioconductor.github.io/BiocManager/" class="external-link">"BiocManager"</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"ComplexHeatmap"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># Install remotes if needed</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://remotes.r-lib.org" class="external-link">"remotes"</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span>  <span class="co"># Download and then load rnaturalearthhires</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"ropensci/rnaturalearthhires"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"rnaturalearthhires"</span>, repos <span class="op">=</span> <span class="st">"https://ropensci.r-universe.dev"</span>, type <span class="op">=</span> <span class="st">"source"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearthhires" class="external-link">rnaturalearthhires</a></span><span class="op">)</span></span></code></pre></div>
<p>Now install <strong>BeeBDC</strong>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"https://github.com/jbdorey/BeeBDC.git"</span>, ref <span class="op">=</span> <span class="st">"main"</span>, </span>
<span>                        force <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                        auth_token <span class="op">=</span> <span class="st">"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"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Downloading GitHub repo jbdorey/BeeBDC@main</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="color: #00BBBB;">R CMD build</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## * checking for file ‘/tmp/RtmpsUTuxv/remotes219d6b69bb26/jbdorey-BeeBDC-be837f29c1fd1595098dd866810b2962ace799c1/DESCRIPTION’ ... OK</span></span>
<span><span class="co">## * preparing ‘BeeBDC’:</span></span>
<span><span class="co">## * checking DESCRIPTION meta-information ... OK</span></span>
<span><span class="co">## * checking for LF line-endings in source and make files and shell scripts</span></span>
<span><span class="co">## * checking for empty or unneeded directories</span></span>
<span><span class="co">## * building ‘BeeBDC_0.2.10.tar.gz’</span></span></code></pre>
<pre><code><span><span class="co">## Installing package into '/home/runner/work/_temp/Library'</span></span>
<span><span class="co">## (as 'lib' is unspecified)</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">BeeBDC</span><span class="op">)</span></span></code></pre></div>
<p>Snapshot the renv environment.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">renv</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/renv/reference/snapshot.html" class="external-link">snapshot</a></span><span class="op">(</span>project <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">RootPath</span>,<span class="st">"/Data_acquisition_workflow"</span><span class="op">)</span>,</span>
<span>                 prompt <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## The following package(s) will be updated in the lockfile:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## # RSPM -----------------------------------------------------------------------</span></span>
<span><span class="co">## - renv   [* -&gt; 1.0.2]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## The version of R recorded in the lockfile will be updated:</span></span>
<span><span class="co">## - R      [* -&gt; 4.3.1]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## - Lockfile written to "~/work/BeeBDC/BeeBDC/inst/extdata/WebDir/Data_acquisition_workflow/renv.lock".</span></span></code></pre>
<p>Set up the directories used by BeeBDC. These directories include
where the data, figures, reports, etc. will be saved. The RDoc needs to
be a path RELATIVE to the RootPath; i.e., the file path from which the
two diverge.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/dirMaker.html">dirMaker</a></span><span class="op">(</span></span>
<span>    RootPath <span class="op">=</span> <span class="va">RootPath</span>,</span>
<span>    RDoc <span class="op">=</span> <span class="st">"vignettes/BeeBDC_main.Rmd"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="co"># Add paths created by this function to the .GlobalEnv</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list2env.html" class="external-link">list2env</a></span><span class="op">(</span>envir <span class="op">=</span> <span class="va">.GlobalEnv</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## here() starts at /home/runner/work/BeeBDC/BeeBDC</span></span></code></pre>
<pre><code><span><span class="co">## &lt;environment: R_GlobalEnv&gt;</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="load-packages">0.3 Load packages<a class="anchor" aria-label="anchor" href="#load-packages"></a>
</h3>
<p>Load packages.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ComplexHeatmap"</span>, <span class="st">"magrittr"</span><span class="op">)</span>, </span>
<span>       <span class="va">library</span>, character.only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: grid</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'grid'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:terra':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     depth</span></span></code></pre>
<pre><code><span><span class="co">## ========================================</span></span>
<span><span class="co">## ComplexHeatmap version 2.16.0</span></span>
<span><span class="co">## Bioconductor page: http://bioconductor.org/packages/ComplexHeatmap/</span></span>
<span><span class="co">## Github page: https://github.com/jokergoo/ComplexHeatmap</span></span>
<span><span class="co">## Documentation: http://jokergoo.github.io/ComplexHeatmap-reference</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## If you use it in published research, please cite either one:</span></span>
<span><span class="co">## - Gu, Z. Complex Heatmap Visualization. iMeta 2022.</span></span>
<span><span class="co">## - Gu, Z. Complex heatmaps reveal patterns and correlations in multidimensional </span></span>
<span><span class="co">##     genomic data. Bioinformatics 2016.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## The new InteractiveComplexHeatmap package can directly export static </span></span>
<span><span class="co">## complex heatmaps into an interactive Shiny app with zero effort. Have a try!</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## This message can be suppressed by:</span></span>
<span><span class="co">##   suppressPackageStartupMessages(library(ComplexHeatmap))</span></span>
<span><span class="co">## ========================================</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'ComplexHeatmap'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:terra':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     draw</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:R.utils':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     draw</span></span></code></pre>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="data-merge">1.0 Data merge<a class="anchor" aria-label="anchor" href="#data-merge"></a>
</h2>
<div class="alert alert-info">
<p><strong> Attention:</strong> <br> Although each line of code has been
validated, in order to save time knitting the R
<strong>markdown</strong> document the next section is display only. If
you are not data merging (section 1.0) or preparing the data (section
2.0), feel free to skip to Section 3.0 Initial flags.</p>
</div>
<div class="section level3">
<h3 id="download-ala-data">1.1 Download ALA data<a class="anchor" aria-label="anchor" href="#download-ala-data"></a>
</h3>
<p>Download ALA data and create a new file in the DataPath to put those
data into. You should also first make an account with ALA in order to
download your data — <a href="https://auth.ala.org.au/userdetails/registration/createAccount" class="external-link uri">https://auth.ala.org.au/userdetails/registration/createAccount</a></p>
<pre><code><span>  <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/atlasDownloader.html">atlasDownloader</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">DataPath</span>,</span>
<span>           userEmail <span class="op">=</span> <span class="st">"your@email.edu.au"</span>,</span>
<span>           atlas <span class="op">=</span> <span class="st">"ALA"</span>,</span>
<span>           ALA_taxon <span class="op">=</span> <span class="st">"Apiformes"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="import-and-merge-ala-scan-idigbio-and-gbif-data">1.2 Import and merge ALA, SCAN, iDigBio, and GBIF data<a class="anchor" aria-label="anchor" href="#import-and-merge-ala-scan-idigbio-and-gbif-data"></a>
</h3>
<p>Supply the path to where the data is, the save_type is either
“csv_files” or “R_file”.</p>
<pre><code><span>  <span class="va">DataImp</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/repoMerge.html">repoMerge</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">DataPath</span>, </span>
<span>                  occ_paths <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/repoFinder.html">repoFinder</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">DataPath</span><span class="op">)</span>,</span>
<span>                  save_type <span class="op">=</span> <span class="st">"R_file"</span><span class="op">)</span></span></code></pre>
<p>If there is an error in finding a file, run <code><a href="../reference/repoFinder.html">repoFinder()</a></code>
by itself to troubleshoot. For example:</p>
<pre><code><span>            <span class="co">#BeeBDC::repoFinder(path = DataPath)</span></span>
<span>            <span class="co">#OUTPUT:</span></span>
<span>            <span class="co">#$ALA_data</span></span>
<span>            <span class="co">#[1] "F:/BeeDataCleaning2022/BeeDataCleaning/BeeDataCleaning/BeeData/ALA_galah_path/galah_download_2022-09-15/data.csv"</span></span>
<span>  </span>
<span>            <span class="co">#$GBIF_data</span></span>
<span>            <span class="co">#[1] "F:/BeeDataCleaning2022/BeeDataCleaning/BeeDataCleaning/BeeData/GBIF_webDL_30Aug2022/0000165-220831081235567/occurrence.txt"</span></span>
<span>            <span class="co">#[2] "F:/BeeDataCleaning2022/BeeDataCleaning/BeeDataCleaning/BeeData/GBIF_webDL_30Aug2022/0436695-210914110416597/occurrence.txt"</span></span>
<span>            <span class="co">#[3] "F:/BeeDataCleaning2022/BeeDataCleaning/BeeDataCleaning/BeeData/GBIF_webDL_30Aug2022/0436697-210914110416597/occurrence.txt"</span></span>
<span>            <span class="co">#[4] "F:/BeeDataCleaning2022/BeeDataCleaning/BeeDataCleaning/BeeData/GBIF_webDL_30Aug2022/0436704-210914110416597/occurrence.txt"</span></span>
<span>            <span class="co">#[5] "F:/BeeDataCleaning2022/BeeDataCleaning/BeeDataCleaning/BeeData/GBIF_webDL_30Aug2022/0436732-210914110416597/occurrence.txt"</span></span>
<span>            <span class="co">#[6] "F:/BeeDataCleaning2022/BeeDataCleaning/BeeDataCleaning/BeeData/GBIF_webDL_30Aug2022/0436733-210914110416597/occurrence.txt"</span></span>
<span>            <span class="co">#[7] "F:/BeeDataCleaning2022/BeeDataCleaning/BeeDataCleaning/BeeData/GBIF_webDL_30Aug2022/0436734-210914110416597/occurrence.txt"</span></span>
<span>                    </span>
<span>            <span class="co">#$iDigBio_data</span></span>
<span>            <span class="co">#[1] "F:/BeeDataCleaning2022/BeeDataCleaning/BeeDataCleaning/BeeData/iDigBio_webDL_30Aug2022/5aa5abe1-62e0-4d8c-bebf-4ac13bd9e56f/occurrence_raw.csv"</span></span>
<span>  </span>
<span>            <span class="co">#$SCAN_data</span></span>
<span>            <span class="co">#character(0)</span></span>
<span>            <span class="co">#Failing because SCAN_data seems to be missing. Downloaded separatly from the one drive</span></span></code></pre>
<p>Load in the most-recent version of these data if needed. This will
return a list with:</p>
<ol style="list-style-type: decimal">
<li><p>The occurrence dataset with attributes (.$Data_WebDL)</p></li>
<li>
<p>The appended eml file (.$eml_files)</p>
<pre><code><span><span class="va">DataImp</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/importOccurrences.html">importOccurrences</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">DataPath</span>,</span>
<span>                       fileName <span class="op">=</span> <span class="st">"BeeData_"</span><span class="op">)</span></span></code></pre>
</li>
</ol>
</div>
<div class="section level3">
<h3 id="import-usgs-data">1.3 Import USGS Data<a class="anchor" aria-label="anchor" href="#import-usgs-data"></a>
</h3>
<p>The <code><a href="../reference/USGS_formatter.html">USGS_formatter()</a></code> will find, import, format, and
create metadata for the USGS dataset. The pubDate must be in
day-month-year format.</p>
<pre><code><span>  <span class="va">USGS_data</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/USGS_formatter.html">USGS_formatter</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">DataPath</span>, pubDate <span class="op">=</span> <span class="st">"19-11-2022"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="formatted-source-importer">1.4 Formatted Source Importer<a class="anchor" aria-label="anchor" href="#formatted-source-importer"></a>
</h3>
<p>Use this importer to find files that have been formatted and need to
be added to the larger data file.</p>
<p>The attributes file must contain “attribute” in its name, and the
occurrence file must not.</p>
<pre><code><span>  <span class="va">Complete_data</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/formattedCombiner.html">formattedCombiner</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">DataPath</span>, </span>
<span>                                strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USGS_[a-zA-Z_]+[0-9]{4}-[0-9]{2}-[0-9]{2}"</span><span class="op">)</span>, </span>
<span>                                  <span class="co"># This should be the list-format with eml attached</span></span>
<span>                                existingOccurrences <span class="op">=</span> <span class="va">DataImp</span><span class="op">$</span><span class="va">Data_WebDL</span>,</span>
<span>                                existingEMLs <span class="op">=</span> <span class="va">DataImp</span><span class="op">$</span><span class="va">eml_files</span><span class="op">)</span> </span></code></pre>
<p>In the column <em>catalogNumber</em>, remove “.*specimennumber:” as
what comes after should be the USGS number to match for duplicates.</p>
<pre><code><span>  <span class="va">Complete_data</span><span class="op">$</span><span class="va">Data_WebDL</span> <span class="op">&lt;-</span> <span class="va">Complete_data</span><span class="op">$</span><span class="va">Data_WebDL</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>catalogNumber <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">catalogNumber</span>,</span>
<span>                                                       pattern <span class="op">=</span> <span class="st">".*\\| specimennumber:"</span>,</span>
<span>                                                       replacement <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span></code></pre>
</div>
<div class="section level3">
<h3 id="save-data">1.5 Save data<a class="anchor" aria-label="anchor" href="#save-data"></a>
</h3>
<p>Choose the type of data format you want to use in saving your work in
1.x.</p>
<pre><code><span>  <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/dataSaver.html">dataSaver</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">DataPath</span>,<span class="co"># The main path to look for data in</span></span>
<span>       save_type <span class="op">=</span> <span class="st">"CSV_file"</span>, <span class="co"># "R_file" OR "CSV_file"</span></span>
<span>       occurrences <span class="op">=</span> <span class="va">Complete_data</span><span class="op">$</span><span class="va">Data_WebDL</span>, <span class="co"># The existing datasheet</span></span>
<span>       eml_files <span class="op">=</span> <span class="va">Complete_data</span><span class="op">$</span><span class="va">eml_files</span>, <span class="co"># The existing EML files</span></span>
<span>       file_prefix <span class="op">=</span> <span class="st">"Fin_"</span><span class="op">)</span> <span class="co"># The prefix for the fileNames</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">Complete_data</span>, <span class="va">DataImp</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="data-preparation">2.0 Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h2>
<p>The data preparatin section of the script relates mostly to
integrating <strong>bee</strong> occurrence datasets and corrections and
so may be skipped by many general taxon users.</p>
<div class="section level3">
<h3 id="standardise-datasets">2.1 Standardise datasets<a class="anchor" aria-label="anchor" href="#standardise-datasets"></a>
</h3>
<p>You may either use:</p>
<ul>
<li><ol style="list-style-type: lower-alpha">
<li>the bdc import method (works well with general datasets)
<strong><em>or</em></strong>
</li>
</ol></li>
<li><ol start="2" style="list-style-type: lower-alpha">
<li>the jbd import method (works well with above data merge)</li>
</ol></li>
</ul>
<div class="section level4">
<h4 id="a--bdc-import">a. bdc import<a class="anchor" aria-label="anchor" href="#a--bdc-import"></a>
</h4>
<p>The bdc import is <strong>NOT</strong> truly supported here, but
provided as an example. Please go to section 2.1b below. Read in the
<strong>bdc</strong> metadata and standardise the dataset to bdc.</p>
<pre><code><span>        <span class="va">bdc_metadata</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"out_file"</span>, <span class="st">"bdc_integration.csv"</span>, sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="co"># ?issue — datasetName is a darwinCore field already!</span></span>
<span>        <span class="co"># Standardise the dataset to bdc</span></span>
<span>        <span class="va">db_standardized</span> <span class="op">&lt;-</span> <span class="fu">bdc</span><span class="fu">::</span><span class="fu"><a href="https://brunobrr.github.io/bdc/reference/bdc_standardize_datasets.html" class="external-link">bdc_standardize_datasets</a></span><span class="op">(</span></span>
<span>          metadata <span class="op">=</span> <span class="va">bdc_metadata</span>,</span>
<span>          format <span class="op">=</span> <span class="st">"csv"</span>,</span>
<span>          overwrite <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          save_database <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>        <span class="co"># read in configuration description file of the column header info</span></span>
<span>        <span class="va">config_description</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"Output"</span>, <span class="st">"bdc_configDesc.csv"</span>,</span>
<span>                                                    sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span>, </span>
<span>                                              show_col_types <span class="op">=</span> <span class="cn">FALSE</span>, trim_ws <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span></code></pre>
</div>
<div class="section level4">
<h4 id="b--jbd-import">b. jbd import<a class="anchor" aria-label="anchor" href="#b--jbd-import"></a>
</h4>
<p>Find the path, read in the file, and add the <em>database_id</em>
column.</p>
<pre><code><span>  <span class="va">occPath</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/fileFinder.html">fileFinder</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">DataPath</span>, fileName <span class="op">=</span> <span class="st">"Fin_BeeData_combined_"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="va">db_standardized</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="va">occPath</span>, </span>
<span>                                       <span class="co"># Use the basic ColTypeR function to determine types</span></span>
<span>                                     col_types <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/ColTypeR.html">ColTypeR</a></span><span class="op">(</span><span class="op">)</span>, trim_ws <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>database_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Dorey_data_"</span>, </span>
<span>                                     <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>                                     .before <span class="op">=</span> <span class="va">family</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="c--optional-thin">c. optional thin<a class="anchor" aria-label="anchor" href="#c--optional-thin"></a>
</h4>
<p>You can thin the dataset for <strong><em>TESTING
ONLY!</em></strong></p>
<pre><code><span>         <span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="va">check_pf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>           <span class="co"># take every 100th record</span></span>
<span>           <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">100</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span></code></pre>
<hr>
</div>
</div>
<div class="section level3">
<h3 id="paige-dataset">2.2 Paige dataset<a class="anchor" aria-label="anchor" href="#paige-dataset"></a>
</h3>
<p>Paige Chesshire’s cleaned American dataset — <a href="https://doi.org/10.1111/ecog.06584" class="external-link uri">https://doi.org/10.1111/ecog.06584</a></p>
<div class="section level4">
<h4 id="import-data">Import data<a class="anchor" aria-label="anchor" href="#import-data"></a>
</h4>
<p>If you haven’t figured it out by now, don’t worry about the column
name warning — not all columns occur here.</p>
<pre><code><span>  <span class="va">PaigeNAm</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"Paige_data"</span>, <span class="st">"NorAmer_highQual_only_ALLfamilies.csv"</span>,</span>
<span>                                    sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span>, col_types <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/ColTypeR.html">ColTypeR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>     <span class="co"># Change the column name from Source to dataSource to match the rest of the data.</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>dataSource <span class="op">=</span> <span class="va">Source</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>     <span class="co"># EXTRACT WAS HERE</span></span>
<span>      <span class="co"># add a NEW database_id column</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      database_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Paige_data_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      .before <span class="op">=</span> <span class="va">scientificName</span><span class="op">)</span></span></code></pre>
<div class="alert alert-info">
<p><strong> Attention:</strong> <br> It is recommended to run the below
code on the full bee dataset with more than 16GB RAM. Robert ran this on
a laptop with 16GB RAM and an Intel(R) Core(TM) i7-8550U processor (4
cores and 8 threads) — it struggled.</p>
</div>
</div>
<div class="section level4">
<h4 id="merge-paiges-data-with-downloaded-data">Merge Paige’s data with downloaded data<a class="anchor" aria-label="anchor" href="#merge-paiges-data-with-downloaded-data"></a>
</h4>
<pre><code><span>  <span class="va">db_standardized</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/PaigeIntegrater.html">PaigeIntegrater</a></span><span class="op">(</span></span>
<span>      db_standardized <span class="op">=</span> <span class="va">db_standardized</span>,</span>
<span>      PaigeNAm <span class="op">=</span> <span class="va">PaigeNAm</span>,</span>
<span>        <span class="co"># This is a list of columns by which to match Paige's data to the most-recent download with. </span></span>
<span>        <span class="co"># Each vector will be matched individually</span></span>
<span>      columnStrings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"decimalLatitude"</span>, <span class="st">"decimalLongitude"</span>, </span>
<span>          <span class="st">"recordNumber"</span>, <span class="st">"recordedBy"</span>, <span class="st">"individualCount"</span>, <span class="st">"samplingProtocol"</span>,</span>
<span>          <span class="st">"associatedTaxa"</span>, <span class="st">"sex"</span>, <span class="st">"catalogNumber"</span>, <span class="st">"institutionCode"</span>, <span class="st">"otherCatalogNumbers"</span>,</span>
<span>          <span class="st">"recordId"</span>, <span class="st">"occurrenceID"</span>, <span class="st">"collectionID"</span><span class="op">)</span>,         <span class="co"># Iteration 1</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"catalogNumber"</span>, <span class="st">"institutionCode"</span>, <span class="st">"otherCatalogNumbers"</span>,</span>
<span>          <span class="st">"recordId"</span>, <span class="st">"occurrenceID"</span>, <span class="st">"collectionID"</span><span class="op">)</span>, <span class="co"># Iteration 2</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"decimalLatitude"</span>, <span class="st">"decimalLongitude"</span>, </span>
<span>          <span class="st">"recordedBy"</span>, <span class="st">"genus"</span>, <span class="st">"specificEpithet"</span><span class="op">)</span>,<span class="co"># Iteration 3</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"decimalLatitude"</span>, <span class="st">"decimalLongitude"</span><span class="op">)</span>,<span class="co"># Iteration 4</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"recordedBy"</span>, <span class="st">"genus"</span>, <span class="st">"specificEpithet"</span>, <span class="st">"locality"</span><span class="op">)</span>, <span class="co"># Iteration 5</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"recordedBy"</span>, <span class="st">"institutionCode"</span>, <span class="st">"genus"</span>, </span>
<span>          <span class="st">"specificEpithet"</span>,<span class="st">"locality"</span><span class="op">)</span>,<span class="co"># Iteration 6</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"occurrenceID"</span>,<span class="st">"decimalLatitude"</span>, <span class="st">"decimalLongitude"</span><span class="op">)</span>,<span class="co"># Iteration 7</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"catalogNumber"</span>,<span class="st">"decimalLatitude"</span>, <span class="st">"decimalLongitude"</span><span class="op">)</span>,<span class="co"># Iteration 8</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"catalogNumber"</span>, <span class="st">"locality"</span><span class="op">)</span> <span class="co"># Iteration 9</span></span>
<span>      <span class="op">)</span> <span class="op">)</span></span></code></pre>
<p>Remove spent data.</p>
<pre><code><span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">PaigeNAm</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="usgs">2.3 USGS<a class="anchor" aria-label="anchor" href="#usgs"></a>
</h3>
<p>The USGS dataset also partially occurs on GBIF from BISON. However,
the occurrence codes are in a silly place… We will correct these here to
help identify duplicates later.</p>
<pre><code><span>    <span class="va">db_standardized</span> <span class="op">&lt;-</span> <span class="va">db_standardized</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="co"># Remove the discoverlife html if it is from USGS</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>occurrenceID <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span></span>
<span>        <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">occurrenceID</span>, <span class="st">"USGS_DRO"</span><span class="op">)</span>,</span>
<span>        <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="va">occurrenceID</span>, <span class="st">"http://www\\.discoverlife\\.org/mp/20l\\?id="</span><span class="op">)</span>,</span>
<span>        <span class="va">occurrenceID</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="co"># Use otherCatalogNumbers when occurrenceID is empty AND when USGS_DRO is detected there</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        occurrenceID <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span></span>
<span>          <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">otherCatalogNumbers</span>, <span class="st">"USGS_DRO"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">occurrenceID</span><span class="op">)</span>,</span>
<span>          <span class="va">otherCatalogNumbers</span>, <span class="va">occurrenceID</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>           <span class="co"># Make sure that no eventIDs have snuck into the occurrenceID columns </span></span>
<span>           <span class="co"># For USGS_DRO, codes with &lt;6 digits are event ids</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        occurrenceID <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">occurrenceID</span>, <span class="st">"USGS_DRO"</span>, negate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>             <span class="co"># Keep occurrenceID if it's NOT USGS_DRO</span></span>
<span>           <span class="va">occurrenceID</span>, </span>
<span>             <span class="co"># If it IS USGS_DRO and it has =&gt; 6 numbers, keep it, else, NA</span></span>
<span>          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">occurrenceID</span>, <span class="st">"USGS_DRO[0-9]{6,10}"</span><span class="op">)</span>,</span>
<span>                         <span class="va">occurrenceID</span>, <span class="cn">NA_character_</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        catalogNumber <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">catalogNumber</span>, <span class="st">"USGS_DRO"</span>, negate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>             <span class="co"># Keep catalogNumber if it's NOT USGS_DRO</span></span>
<span>          <span class="va">catalogNumber</span>, </span>
<span>             <span class="co"># If it IS USGS_DRO and it has =&gt; 6 numbers, keep it, else, NA</span></span>
<span>          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">catalogNumber</span>, <span class="st">"USGS_DRO[0-9]{6,10}"</span><span class="op">)</span>,</span>
<span>                         <span class="va">catalogNumber</span>, <span class="cn">NA_character_</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="additional-datasets">2.4 Additional datasets<a class="anchor" aria-label="anchor" href="#additional-datasets"></a>
</h3>
<div class="section level4">
<h4 id="import-additional-and-potentially-private-datasets-">Import additional and potentially private datasets.<a class="anchor" aria-label="anchor" href="#import-additional-and-potentially-private-datasets-"></a>
</h4>
<p><strong>Note:</strong> Private dataset functions are provided but the
data itself is not integrated here until those datasets become freely
available.</p>
<p>There will be some warnings were a few rows may not be formatted
correctly or where dates fail to parse. This is normal.</p>
<div class="section level7">
<h6 id="a--epel">a. EPEL<a class="anchor" aria-label="anchor" href="#a--epel"></a>
</h6>
<p>Guzman, L. M., Kelly, T. &amp; Elle, E. A data set for pollinator
diversity and their interactions with plants in the Pacific Northwest.
Ecology, e3927 (2022). <a href="https://doi.org/10.1002/ecy.3927" class="external-link uri">https://doi.org/10.1002/ecy.3927</a></p>
<pre><code><span><span class="va">EPEL_Data</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/readr_BeeBDC.html">readr_BeeBDC</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"EPEL"</span>,</span>
<span>                                path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span><span class="op">)</span>,</span>
<span>                      inFile <span class="op">=</span> <span class="st">"/InputDatasets/bee_data_canada.csv"</span>,</span>
<span>                      outFile <span class="op">=</span> <span class="st">"jbd_EPEL_data.csv"</span>,</span>
<span>                      dataLicense <span class="op">=</span> <span class="st">"https://creativecommons.org/licenses/by-nc-sa/4.0/"</span><span class="op">)</span></span>
<span>                      </span></code></pre>
</div>
<div class="section level7">
<h6 id="b--allan-smith-pardo">b. Allan Smith-Pardo<a class="anchor" aria-label="anchor" href="#b--allan-smith-pardo"></a>
</h6>
<p>Data from Allan Smith-Pardo</p>
<pre><code><span><span class="va">ASP_Data</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/readr_BeeBDC.html">readr_BeeBDC</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"ASP"</span>,</span>
<span>                               path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span><span class="op">)</span>,</span>
<span>                      inFile <span class="op">=</span> <span class="st">"/InputDatasets/Allan_Smith-Pardo_Dorey_ready2.csv"</span>,</span>
<span>                      outFile <span class="op">=</span> <span class="st">"jbd_ASP_data.csv"</span>,</span>
<span>                      dataLicense <span class="op">=</span> <span class="st">"https://creativecommons.org/licenses/by-nc-sa/4.0/"</span><span class="op">)</span></span>
<span>                      </span></code></pre>
</div>
<div class="section level7">
<h6 id="c--minckley">c. Minckley<a class="anchor" aria-label="anchor" href="#c--minckley"></a>
</h6>
<p>Data from Robert Minckley</p>
<pre><code><span><span class="va">BMin_Data</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/readr_BeeBDC.html">readr_BeeBDC</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"BMin"</span>,</span>
<span>                                path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span><span class="op">)</span>,</span>
<span>                        inFile <span class="op">=</span> <span class="st">"/InputDatasets/Bob_Minckley_6_1_22_ScanRecent-mod_Dorey.csv"</span>,</span>
<span>                        outFile <span class="op">=</span> <span class="st">"jbd_BMin_data.csv"</span>,</span>
<span>                        dataLicense <span class="op">=</span> <span class="st">"https://creativecommons.org/licenses/by-nc-sa/4.0/"</span><span class="op">)</span></span>
<span>                        </span></code></pre>
</div>
<div class="section level7">
<h6 id="d--bmont">d. BMont<a class="anchor" aria-label="anchor" href="#d--bmont"></a>
</h6>
<p>Delphia, C. M. Bumble bees of Montana. <a href="https://www.mtent.org/projects/Bumble_Bees/bombus_species.html" class="external-link uri">https://www.mtent.org/projects/Bumble_Bees/bombus_species.html</a>.
(2022)</p>
<pre><code><span><span class="va">BMont_Data</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/readr_BeeBDC.html">readr_BeeBDC</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"BMont"</span>,</span>
<span>                                 path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span><span class="op">)</span>,</span>
<span>                          inFile <span class="op">=</span> <span class="st">"/InputDatasets/Bombus_Montana_dorey.csv"</span>,</span>
<span>                          outFile <span class="op">=</span> <span class="st">"jbd_BMont_data.csv"</span>,</span>
<span>                          dataLicense <span class="op">=</span> <span class="st">"https://creativecommons.org/licenses/by-sa/4.0/"</span><span class="op">)</span></span>
<span>                          </span></code></pre>
</div>
<div class="section level7">
<h6 id="e--ecd">e. Ecd<a class="anchor" aria-label="anchor" href="#e--ecd"></a>
</h6>
<p>Ecdysis. Ecdysis: a portal for live-data arthropod collections, <a href="https://serv.biokic.asu.edu/ecdysis/index.php" class="external-link uri">https://serv.biokic.asu.edu/ecdysis/index.php</a>
(2022).</p>
<pre><code><span><span class="va">Ecd_Data</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/readr_BeeBDC.html">readr_BeeBDC</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"Ecd"</span>,</span>
<span>                               path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span><span class="op">)</span>,</span>
<span>                      inFile <span class="op">=</span> <span class="st">"/InputDatasets/Ecdysis_occs.csv"</span>,</span>
<span>                      outFile <span class="op">=</span> <span class="st">"jbd_Ecd_data.csv"</span>,</span>
<span>                      dataLicense <span class="op">=</span> <span class="st">"https://creativecommons.org/licenses/by-nc-sa/4.0/"</span><span class="op">)</span></span>
<span>                      </span></code></pre>
</div>
<div class="section level7">
<h6 id="f--gai">f. Gai<a class="anchor" aria-label="anchor" href="#f--gai"></a>
</h6>
<p>Gaiarsa, M. P., Kremen, C. &amp; Ponisio, L. C. Pollinator
interaction flexibility across scales affects patch colonization and
occupancy. <em>Nature Ecology &amp; Evolution</em> 5, 787-793 (2021). <a href="https://doi.org/10.1038/s41559-021-01434-y" class="external-link uri">https://doi.org/10.1038/s41559-021-01434-y</a></p>
<pre><code><span><span class="va">Gai_Data</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/readr_BeeBDC.html">readr_BeeBDC</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"Gai"</span>,</span>
<span>                               path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span><span class="op">)</span>,</span>
<span>                      inFile <span class="op">=</span> <span class="st">"/InputDatasets/upload_to_scan_Gaiarsa et al_Dorey.csv"</span>,</span>
<span>                      outFile <span class="op">=</span> <span class="st">"jbd_Gai_data.csv"</span>,</span>
<span>                      dataLicense <span class="op">=</span> <span class="st">"https://creativecommons.org/licenses/by-nc-sa/4.0/"</span><span class="op">)</span></span>
<span>                      </span></code></pre>
</div>
<div class="section level7">
<h6 id="g--caes">g. CAES<a class="anchor" aria-label="anchor" href="#g--caes"></a>
</h6>
<p>From the Connecticut Agricultural Experiment Station</p>
<pre><code><span><span class="va">CAES_Data</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/readr_BeeBDC.html">readr_BeeBDC</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"CAES"</span>,</span>
<span>                                path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span><span class="op">)</span>,</span>
<span>                        inFile <span class="op">=</span> <span class="st">"/InputDatasets/CT_BEE_DATA_FROM_PBI.xlsx"</span>,</span>
<span>                        outFile <span class="op">=</span> <span class="st">"jbd_CT_Data.csv"</span>,</span>
<span>                        sheet <span class="op">=</span> <span class="st">"Sheet1"</span>,</span>
<span>                        dataLicense <span class="op">=</span> <span class="st">"https://creativecommons.org/licenses/by-nc-sa/4.0/"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level7">
<h6 id="h--geol">h. GeoL<a class="anchor" aria-label="anchor" href="#h--geol"></a>
</h6>
<pre><code><span><span class="va">GeoL_Data</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/readr_BeeBDC.html">readr_BeeBDC</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"GeoL"</span>,</span>
<span>                                path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span><span class="op">)</span>,</span>
<span>                        inFile <span class="op">=</span> <span class="st">"/InputDatasets/Geolocate and BELS_certain and accurate.xlsx"</span>,</span>
<span>                        outFile <span class="op">=</span> <span class="st">"jbd_GeoL_Data.csv"</span>,</span>
<span>                        dataLicense <span class="op">=</span> <span class="st">"https://creativecommons.org/licenses/by-nc-sa/4.0/"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level7">
<h6 id="i--eaco">i. EaCO<a class="anchor" aria-label="anchor" href="#i--eaco"></a>
</h6>
<pre><code><span><span class="va">EaCO_Data</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/readr_BeeBDC.html">readr_BeeBDC</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"EaCO"</span>,</span>
<span>                                path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span><span class="op">)</span>,</span>
<span>                        inFile <span class="op">=</span> <span class="st">"/InputDatasets/Eastern Colorado bee 2017 sampling.xlsx"</span>,</span>
<span>                        outFile <span class="op">=</span> <span class="st">"jbd_EaCo_Data.csv"</span>,</span>
<span>                        dataLicense <span class="op">=</span> <span class="st">"https://creativecommons.org/licenses/by-nc-sa/4.0/"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level7">
<h6 id="j--fsca">j. FSCA<a class="anchor" aria-label="anchor" href="#j--fsca"></a>
</h6>
<p>Florida State Collection of Arthropods</p>
<pre><code><span><span class="va">FSCA_Data</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/readr_BeeBDC.html">readr_BeeBDC</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"FSCA"</span>,</span>
<span>                                path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span><span class="op">)</span>,</span>
<span>                        inFile <span class="op">=</span> <span class="st">"InputDatasets/fsca_9_15_22_occurrences.csv"</span>,</span>
<span>                        outFile <span class="op">=</span> <span class="st">"jbd_FSCA_Data.csv"</span>,</span>
<span>                        dataLicense <span class="op">=</span> <span class="st">"https://creativecommons.org/licenses/by-nc-sa/4.0/"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level7">
<h6 id="k--texas-smc">k. Texas SMC<a class="anchor" aria-label="anchor" href="#k--texas-smc"></a>
</h6>
<p>Published or unpublished data from Texas literature not in an online
database, usually copied into spreadsheet from document format, or
otherwise copied from a very differently-formatted spreadsheet.
Unpublished or partially published data were obtained with express
permission from the lead author.</p>
<pre><code><span><span class="va">SMC_Data</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/readr_BeeBDC.html">readr_BeeBDC</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"SMC"</span>,</span>
<span>                               path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span><span class="op">)</span>,</span>
<span>                      inFile <span class="op">=</span> <span class="st">"/InputDatasets/TXbeeLitOccs_31Oct22.csv"</span>, </span>
<span>                      outFile <span class="op">=</span> <span class="st">"jbd_SMC_Data.csv"</span>,</span>
<span>                      dataLicense <span class="op">=</span> <span class="st">"https://creativecommons.org/licenses/by-nc-sa/4.0/"</span><span class="op">)</span></span>
<span>                      </span></code></pre>
</div>
<div class="section level7">
<h6 id="l--texas-bal">l. Texas Bal<a class="anchor" aria-label="anchor" href="#l--texas-bal"></a>
</h6>
<p>Data with GPS coordinates from Ballare, K. M., Neff, J. L., Ruppel,
R. &amp; Jha, S. Multi-scalar drivers of biodiversity: local management
mediates wild bee community response to regional urbanization.
<em>Ecological Applications</em> 29, e01869 (2019), <a href="https://doi.org/10.1002/eap.1869" class="external-link uri">https://doi.org/10.1002/eap.1869</a>. The version on Dryad
is missing site GPS coordinates (by accident). Kim is okay with these
data being made public as long as her paper is referenced. - Elinor
Lichtenberg</p>
<pre><code><span><span class="va">Bal_Data</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/readr_BeeBDC.html">readr_BeeBDC</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"Bal"</span>,</span>
<span>                               path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span><span class="op">)</span>,</span>
<span>                      inFile <span class="op">=</span> <span class="st">"/InputDatasets/Beedata_ballare.xlsx"</span>, </span>
<span>                      outFile <span class="op">=</span> <span class="st">"jbd_Bal_Data.csv"</span>,</span>
<span>                      sheet <span class="op">=</span> <span class="st">"animal_data"</span>,</span>
<span>                      dataLicense <span class="op">=</span> <span class="st">"https://creativecommons.org/licenses/by-nc-sa/4.0/"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level7">
<h6 id="m--palouse-lic">m. Palouse Lic<a class="anchor" aria-label="anchor" href="#m--palouse-lic"></a>
</h6>
<p>Attached: My canola data. I tried to get this in DarwinCore format.
These data go with a manuscript currently under review. Here’s the
bioRxiv version: Lichtenberg, E. M., Milosavljević, I., Campbell, A. J.
&amp; Crowder, D. W. Differential effects of soil conservation practices
on arthropods and crop yield. <em>bioRxiv</em>, <a href="https://doi.org/10.1101/2021.1112.1106.471474" class="external-link uri">https://doi.org/10.1101/2021.1112.1106.471474</a> (2022) <a href="https://www.biorxiv.org/content/10.1101/2021.12.06.471474v2" class="external-link uri">https://www.biorxiv.org/content/10.1101/2021.12.06.471474v2</a>.
These are the data I will be putting on SCAN. - Elinor Lichtenberg</p>
<pre><code><span><span class="va">Lic_Data</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/readr_BeeBDC.html">readr_BeeBDC</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"Lic"</span>,</span>
<span>                               path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span><span class="op">)</span>,</span>
<span>                      inFile <span class="op">=</span> <span class="st">"/InputDatasets/Lichtenberg_canola_records.csv"</span>, </span>
<span>                      outFile <span class="op">=</span> <span class="st">"jbd_Lic_Data.csv"</span>,</span>
<span>                      dataLicense <span class="op">=</span> <span class="st">"https://creativecommons.org/licenses/by-nc-sa/4.0/"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level7">
<h6 id="n--arm">n. Arm<a class="anchor" aria-label="anchor" href="#n--arm"></a>
</h6>
<pre><code><span><span class="va">Arm_Data</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/readr_BeeBDC.html">readr_BeeBDC</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"Arm"</span>,</span>
<span>                               path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span><span class="op">)</span>,</span>
<span>                      inFile <span class="op">=</span> <span class="st">"/InputDatasets/Bee database Armando_Final.xlsx"</span>,</span>
<span>                      outFile <span class="op">=</span> <span class="st">"jbd_Arm_Data.csv"</span>,</span>
<span>                      sheet <span class="op">=</span> <span class="st">"Sheet1"</span>,</span>
<span>                      dataLicense <span class="op">=</span> <span class="st">"https://creativecommons.org/licenses/by-nc-sa/4.0/"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level7">
<h6 id="o--dor">o. Dor<a class="anchor" aria-label="anchor" href="#o--dor"></a>
</h6>
<p>From several papers: <a href="https://doi.org/10.3897/jhr.79.57308" class="external-link uri">https://doi.org/10.3897/jhr.79.57308</a>, <a href="https://doi.org/10.3897/jhr.81.59365" class="external-link uri">https://doi.org/10.3897/jhr.81.59365</a>, and <a href="https://doi.org/10.11646/zootaxa.4674.1.1" class="external-link uri">https://doi.org/10.11646/zootaxa.4674.1.1</a>.</p>
<pre><code><span><span class="va">Dor_Data</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/readr_BeeBDC.html">readr_BeeBDC</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"Dor"</span>,</span>
<span>                               path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span><span class="op">)</span>,</span>
<span>                      inFile <span class="op">=</span> <span class="st">"/InputDatasets/DoreyData.csv"</span>,</span>
<span>                      outFile <span class="op">=</span> <span class="st">"jbd_Dor_Data.csv"</span>,</span>
<span>                      dataLicense <span class="op">=</span> <span class="st">"https://creativecommons.org/licenses/by-nc-sa/4.0/"</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="merge-all">2.5 Merge all<a class="anchor" aria-label="anchor" href="#merge-all"></a>
</h4>
<p>Remove these spent datasets.</p>
<pre><code><span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">EPEL_Data</span>, <span class="va">ASP_Data</span>, <span class="va">BMin_Data</span>, <span class="va">BMont_Data</span>, <span class="va">Ecd_Data</span>, <span class="va">Gai_Data</span>, <span class="va">CAES_Data</span>, </span>
<span>  <span class="va">GeoL_Data</span>, <span class="va">EaCO_Data</span>, <span class="va">FSCA_Data</span>, <span class="va">SMC_Data</span>, <span class="va">Bal_Data</span>, <span class="va">Lic_Data</span>, <span class="va">Arm_Data</span>, <span class="va">Dor_Data</span><span class="op">)</span></span></code></pre>
<p>Read in and merge all. There are more <code><a href="../reference/readr_BeeBDC.html">readr_BeeBDC()</a></code>
supported than currently implemented and these represent datasets that
will be publicly released in the future. See
‘?<code><a href="../reference/readr_BeeBDC.html">readr_BeeBDC()</a></code>’ for details.</p>
<pre><code><span><span class="va">db_standardized</span> <span class="op">&lt;-</span> <span class="va">db_standardized</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span>, </span>
<span>                           <span class="st">"/jbd_ASP_data.csv"</span><span class="op">)</span>, col_types <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/ColTypeR.html">ColTypeR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span>, </span>
<span>                           <span class="st">"/jbd_EPEL_data.csv"</span><span class="op">)</span>, col_types <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/ColTypeR.html">ColTypeR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span>, </span>
<span>                           <span class="st">"/jbd_BMin_data.csv"</span><span class="op">)</span>, col_types <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/ColTypeR.html">ColTypeR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span>, </span>
<span>                           <span class="st">"/jbd_BMont_data.csv"</span><span class="op">)</span>, col_types <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/ColTypeR.html">ColTypeR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span>, </span>
<span>                           <span class="st">"/jbd_Ecd_data.csv"</span><span class="op">)</span>, col_types <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/ColTypeR.html">ColTypeR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span>, </span>
<span>                           <span class="st">"/jbd_Gai_data.csv"</span><span class="op">)</span>, col_types <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/ColTypeR.html">ColTypeR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span>, </span>
<span>                           <span class="st">"/jbd_CT_Data.csv"</span><span class="op">)</span>, col_types <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/ColTypeR.html">ColTypeR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span>, </span>
<span>                           <span class="st">"/jbd_GeoL_Data.csv"</span><span class="op">)</span>, col_types <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/ColTypeR.html">ColTypeR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span>, </span>
<span>                           <span class="st">"/jbd_EaCo_Data.csv"</span><span class="op">)</span>, col_types <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/ColTypeR.html">ColTypeR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span>, </span>
<span>                           <span class="st">"/jbd_SMC_Data.csv"</span><span class="op">)</span>, col_types <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/ColTypeR.html">ColTypeR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span>, </span>
<span>                           <span class="st">"/jbd_Bal_Data.csv"</span><span class="op">)</span>, col_types <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/ColTypeR.html">ColTypeR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span>, </span>
<span>                           <span class="st">"/jbd_Lic_Data.csv"</span><span class="op">)</span>, col_types <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/ColTypeR.html">ColTypeR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span>, </span>
<span>                           <span class="st">"/jbd_Arm_Data.csv"</span><span class="op">)</span>, col_types <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/ColTypeR.html">ColTypeR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">DataPath</span>, <span class="st">"/Additional_Datasets"</span>, </span>
<span>                           <span class="st">"/jbd_Dor_Data.csv"</span><span class="op">)</span>, col_types <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/ColTypeR.html">ColTypeR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="co"># END bind_rows</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span>classes <span class="op">=</span> <span class="st">"warning"</span><span class="op">)</span> <span class="co"># End suppressWarnings — due to col_types</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="match-database_id">2.6 Match database_id<a class="anchor" aria-label="anchor" href="#match-database_id"></a>
</h4>
<p>If you have prior runs from which you’d like to match
<em>database_id</em>s with from the current run, you may use the below
script to try to match <em>database_id</em>s with prior runs.</p>
<p>Read in a prior run of choice.</p>
<pre><code><span>  <span class="va">priorRun</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/fileFinder.html">fileFinder</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">DataPath</span>,</span>
<span>                          file <span class="op">=</span> <span class="st">"01_prefilter_database_9Aug22.csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">.</span>, col_types <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/ColTypeR.html">ColTypeR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p>This function will attempt to find the <em>database_id</em>s from
prior runs.</p>
<pre><code><span>  <span class="va">db_standardized</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/idMatchR.html">idMatchR</a></span><span class="op">(</span></span>
<span>  currentData <span class="op">=</span> <span class="va">db_standardized</span>,</span>
<span>  priorData <span class="op">=</span> <span class="va">priorRun</span>,</span>
<span>    <span class="co"># First matches will be given preference over later ones</span></span>
<span>  matchBy <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/lst.html" class="external-link">lst</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gbifID"</span>, <span class="st">"dataSource"</span><span class="op">)</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"catalogNumber"</span>, <span class="st">"institutionCode"</span>, <span class="st">"dataSource"</span>, <span class="st">"decimalLatitude"</span>,</span>
<span>                          <span class="st">"decimalLongitude"</span><span class="op">)</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"occurrenceID"</span>, <span class="st">"dataSource"</span>,<span class="st">"decimalLatitude"</span>,<span class="st">"decimalLongitude"</span><span class="op">)</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"recordId"</span>, <span class="st">"dataSource"</span>,<span class="st">"decimalLatitude"</span>,<span class="st">"decimalLongitude"</span><span class="op">)</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"dataSource"</span>,<span class="st">"decimalLatitude"</span>,<span class="st">"decimalLongitude"</span><span class="op">)</span>,</span>
<span>                        <span class="co"># Because INHS was entered as it's own dataset but is now included in the GBIF    download...</span></span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"catalogNumber"</span>, <span class="st">"institutionCode"</span>, <span class="st">"dataSource"</span>,</span>
<span>                          <span class="st">"decimalLatitude"</span>,<span class="st">"decimalLongitude"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="co"># You can exclude datasets from prior by matching their prefixs — before first underscore:</span></span>
<span>  excludeDataset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ASP"</span>, <span class="st">"BMin"</span>, <span class="st">"BMont"</span>, <span class="st">"CAES"</span>, <span class="st">"EaCO"</span>, <span class="st">"Ecd"</span>, <span class="st">"EcoS"</span>,</span>
<span>                     <span class="st">"Gai"</span>, <span class="st">"KP"</span>, <span class="st">"EPEL"</span>, <span class="st">"CAES"</span>, <span class="st">"EaCO"</span>, <span class="st">"FSCA"</span>, <span class="st">"SMC"</span>, <span class="st">"Lic"</span>, <span class="st">"Arm"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span> <span class="co"># Remove redundant files</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">priorRun</span><span class="op">)</span></span></code></pre>
<p>Save the dataset.</p>
<pre><code><span>  <span class="va">db_standardized</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_excel_csv</a></span><span class="op">(</span><span class="va">.</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">OutPath_Intermediate</span>, <span class="st">"00_prefilter_database.csv"</span>,</span>
<span>                           sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="initial-flags">3.0 Initial flags<a class="anchor" aria-label="anchor" href="#initial-flags"></a>
</h2>
<p>Read data back in if needed. OutPath_Intermediate (and a few other
directories) should be have been created and saved to the global
environment by <code><a href="../reference/dirMaker.html">dirMaker()</a></code>.</p>
<pre><code><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"db_standardized"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">db_standardized</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">OutPath_Intermediate</span>, <span class="st">"00_prefilter_database.csv"</span>,</span>
<span>                                    sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span>, col_types <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/ColTypeR.html">ColTypeR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span></code></pre>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"bees3sp"</span>, package <span class="op">=</span> <span class="st">"BeeBDC"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"beesRaw"</span>, package <span class="op">=</span> <span class="st">"BeeBDC"</span><span class="op">)</span></span>
<span><span class="va">db_standardized</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">beesRaw</span>, </span>
<span>                                      <span class="co"># Only keep a subset of columns from bees3sp</span></span>
<span>                             <span class="va">bees3sp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu">tidyselect</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">beesRaw</span><span class="op">)</span><span class="op">)</span>, <span class="va">countryCode</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><em>For more details about the bdc package, please see their <a href="https://brunobrr.github.io/bdc/articles/prefilter.html" class="external-link">tutorial.</a></em></p>
<div class="section level3">
<h3 id="sciname">3.1 SciName<a class="anchor" aria-label="anchor" href="#sciname"></a>
</h3>
<p>Flag occurrences without <em>scientificName</em> provided.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu">bdc</span><span class="fu">::</span><span class="fu"><a href="https://brunobrr.github.io/bdc/reference/bdc_scientificName_empty.html" class="external-link">bdc_scientificName_empty</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">db_standardized</span>,</span>
<span>  sci_name <span class="op">=</span> <span class="st">"scientificName"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## bdc_scientificName_empty:</span></span>
<span><span class="co">## Flagged 0 records.</span></span>
<span><span class="co">## One column was added to the database.</span></span></code></pre>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># now that this is saved, remove it to save space in memory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">db_standardized</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="misscoords">3.2 MissCoords<a class="anchor" aria-label="anchor" href="#misscoords"></a>
</h3>
<p>Flag occurrences with missing <em>decimalLatitude</em> and
<em>decimalLongitude</em>.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu">bdc</span><span class="fu">::</span><span class="fu"><a href="https://brunobrr.github.io/bdc/reference/bdc_coordinates_empty.html" class="external-link">bdc_coordinates_empty</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">check_pf</span>,</span>
<span>  lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  lon <span class="op">=</span> <span class="st">"decimalLongitude"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## bdc_coordinates_empty:</span></span>
<span><span class="co">## Flagged 42 records.</span></span>
<span><span class="co">## One column was added to the database.</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="outofrange">3.3 OutOfRange<a class="anchor" aria-label="anchor" href="#outofrange"></a>
</h3>
<p>Flag occurrences that are not on Earth (outside of -180 to 180 or -90
to 90 degrees).</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu">bdc</span><span class="fu">::</span><span class="fu"><a href="https://brunobrr.github.io/bdc/reference/bdc_coordinates_outOfRange.html" class="external-link">bdc_coordinates_outOfRange</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">check_pf</span>,</span>
<span>  lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  lon <span class="op">=</span> <span class="st">"decimalLongitude"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## bdc_coordinates_outOfRange:</span></span>
<span><span class="co">## Flagged 0 records.</span></span>
<span><span class="co">## One column was added to the database.</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="source">3.4 Source<a class="anchor" aria-label="anchor" href="#source"></a>
</h3>
<p>Flag occurrences that don’t match the <em>basisOfRecord</em> types
below.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu">bdc</span><span class="fu">::</span><span class="fu"><a href="https://brunobrr.github.io/bdc/reference/bdc_basisOfRecords_notStandard.html" class="external-link">bdc_basisOfRecords_notStandard</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">check_pf</span>,</span>
<span>  basisOfRecord <span class="op">=</span> <span class="st">"basisOfRecord"</span>,</span>
<span>  names_to_keep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="co"># Keep all plus some at the bottom.</span></span>
<span>    <span class="st">"Event"</span>,</span>
<span>    <span class="st">"HUMAN_OBSERVATION"</span>,</span>
<span>    <span class="st">"HumanObservation"</span>,</span>
<span>    <span class="st">"LIVING_SPECIMEN"</span>,</span>
<span>    <span class="st">"LivingSpecimen"</span>,</span>
<span>    <span class="st">"MACHINE_OBSERVATION"</span>,</span>
<span>    <span class="st">"MachineObservation"</span>,</span>
<span>    <span class="st">"MATERIAL_SAMPLE"</span>,</span>
<span>    <span class="st">"O"</span>,</span>
<span>    <span class="st">"Occurrence"</span>,</span>
<span>    <span class="st">"MaterialSample"</span>,</span>
<span>    <span class="st">"OBSERVATION"</span>,</span>
<span>    <span class="st">"Preserved Specimen"</span>,</span>
<span>    <span class="st">"PRESERVED_SPECIMEN"</span>,</span>
<span>    <span class="st">"preservedspecimen Specimen"</span>,</span>
<span>    <span class="st">"Preservedspecimen"</span>,</span>
<span>    <span class="st">"PreservedSpecimen"</span>,</span>
<span>    <span class="st">"preservedspecimen"</span>,</span>
<span>    <span class="st">"S"</span>,</span>
<span>    <span class="st">"Specimen"</span>,</span>
<span>    <span class="st">"Taxon"</span>,</span>
<span>    <span class="st">"UNKNOWN"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="cn">NA</span>,</span>
<span>    <span class="st">"NA"</span>,</span>
<span>    <span class="st">"LITERATURE"</span>, </span>
<span>    <span class="st">"None"</span>, <span class="st">"Pinned Specimen"</span>, <span class="st">"Voucher reared"</span>, <span class="st">"Emerged specimen"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## bdc_basisOfRecords_notStandard:</span></span>
<span><span class="co">## Flagged 1 of the following specific nature:</span></span>
<span><span class="co">##  MATERIAL_CITATION </span></span>
<span><span class="co">## One column was added to the database.</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="countryname">3.5 CountryName<a class="anchor" aria-label="anchor" href="#countryname"></a>
</h3>
<p>Try to harmonise country names.</p>
<div class="section level4">
<h4 id="a--prepare-dataset">a. prepare dataset<a class="anchor" aria-label="anchor" href="#a--prepare-dataset"></a>
</h4>
<p>Fix up country names based on common problems above and extract ISO2
codes for occurrences.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_pf_noNa</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/countryNameCleanR.html">countryNameCleanR</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">check_pf</span>,</span>
<span>    <span class="co"># Create a Tibble of common issues in country names and their replacements</span></span>
<span>  commonProblems <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>problem <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'U.S.A.'</span>, <span class="st">'US'</span>,<span class="st">'USA'</span>,<span class="st">'usa'</span>,<span class="st">'UNITED STATES'</span>,</span>
<span>                                              <span class="st">'United States'</span>,<span class="st">'U.S.A'</span>,<span class="st">'MX'</span>,<span class="st">'CA'</span>,<span class="st">'Bras.'</span>,<span class="st">'Braz.'</span>,</span>
<span>                                              <span class="st">'Brasil'</span>,<span class="st">'CNMI'</span>,<span class="st">'USA TERRITORY: PUERTO RICO'</span><span class="op">)</span>,</span>
<span>                                  fix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'United States of America'</span>,<span class="st">'United States of America'</span>,</span>
<span>                                          <span class="st">'United States of America'</span>,<span class="st">'United States of America'</span>,</span>
<span>                                          <span class="st">'United States of America'</span>,<span class="st">'United States of America'</span>,</span>
<span>                                          <span class="st">'United States of America'</span>,<span class="st">'Mexico'</span>,<span class="st">'Canada'</span>,<span class="st">'Brazil'</span>,</span>
<span>                                          <span class="st">'Brazil'</span>,<span class="st">'Brazil'</span>,<span class="st">'Northern Mariana Islands'</span>,<span class="st">'PUERTO.RICO'</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  - Using default country names and codes from https:en.wikipedia.org/wiki/ISO_3166-1_alpha-2 - static version from July 2022.</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="b--run-function">b. run function<a class="anchor" aria-label="anchor" href="#b--run-function"></a>
</h4>
<p>Get country name from coordinates using a wrapper around the
<code><a href="../reference/jbd_country_from_coordinates.html">jbd_country_from_coordinates()</a></code> function. Because our
dataset is much larger than those used to design <strong>bdc</strong>,
we have made it so that you can analyse data in smaller pieces.
Additionally, like some other functions in <strong>BeeBDC</strong>, we
have implemented parallel operations (using mc.cores = #cores in
stepSize = #rowsPerOperation); see ‘?<code><a href="../reference/jbd_CfC_chunker.html">jbd_CfC_chunker()</a></code>’ for
details. NOTE: In an actual run you should use scale = “large”</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span></span>
<span>  <span class="va">countryOutput</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/jbd_CfC_chunker.html">jbd_CfC_chunker</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">check_pf_noNa</span>,</span>
<span>                                   lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>                                   lon <span class="op">=</span> <span class="st">"decimalLongitude"</span>,</span>
<span>                                   country <span class="op">=</span> <span class="st">"country"</span>,</span>
<span>                                    <span class="co"># How many rows to process at a time</span></span>
<span>                                   stepSize <span class="op">=</span> <span class="fl">1000000</span>,</span>
<span>                                    <span class="co"># Start row</span></span>
<span>                                   chunkStart <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                   path <span class="op">=</span> <span class="va">OutPath_Intermediate</span>,</span>
<span>                                   append <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                    <span class="co"># Normally, please use scale = "large"</span></span>
<span>                                   scale <span class="op">=</span> <span class="st">"medium"</span>,</span>
<span>                                   mc.cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  classes <span class="op">=</span> <span class="st">"warning"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  - Starting chunk 1...</span></span>
<span><span class="co">## From 1 to 1,000,000</span></span>
<span><span class="co">##  - Cleaning RAM.</span></span>
<span><span class="co">##  - Finished chunk 1 of 1 chunks. Records examined: 1,000,000</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="c--re-merge">c. re-merge<a class="anchor" aria-label="anchor" href="#c--re-merge"></a>
</h4>
<p>Join these datasets.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">check_pf</span>, </span>
<span>                             <span class="va">countryOutput</span>, </span>
<span>                             by <span class="op">=</span> <span class="st">"database_id"</span>,</span>
<span>                             suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"CO"</span><span class="op">)</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="co"># Take the new country name if the original is NA</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>country <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span>,</span>
<span>                                         <span class="va">countryCO</span>,</span>
<span>                                         <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co"># Remove duplicates if they arose from left_join!</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Save the dataset.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_pf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_excel_csv</a></span><span class="op">(</span><span class="va">.</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">OutPath_Intermediate</span>, <span class="st">"01_prefilter_database.csv"</span>,</span>
<span>                         sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Read in if needed.</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"check_pf"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">DataPath</span>, </span>
<span>             <span class="st">"Output"</span>, <span class="st">"Intermediate"</span>, <span class="st">"01_prefilter_database.csv"</span>, sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span>,</span>
<span>             col_types <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/ColTypeR.html">ColTypeR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
<p>Remove these interim datasets.</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">check_pf_noNa</span>, <span class="va">countryOutput</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="standardconames">3.6 StandardCoNames<a class="anchor" aria-label="anchor" href="#standardconames"></a>
</h3>
<p>Run the function, which standardises country names and adds ISO2
codes, if needed.</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># Standardise country names and add ISO2 codes if needed</span></span>
<span><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu">bdc</span><span class="fu">::</span><span class="fu"><a href="https://brunobrr.github.io/bdc/reference/bdc_country_standardized.html" class="external-link">bdc_country_standardized</a></span><span class="op">(</span></span>
<span>  <span class="co"># Remove the countryCode and country_suggested columns to avoid an error with </span></span>
<span>    <span class="co"># where two "countryCode" and "country_suggested" columns exist (i.e. if the dataset has been  </span></span>
<span>    <span class="co"># run before)</span></span>
<span>  data <span class="op">=</span> <span class="va">check_pf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">!</span><span class="fu">tidyselect</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"countryCode"</span>, <span class="st">"country_suggested"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  country <span class="op">=</span> <span class="st">"country"</span></span>
<span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## Loading auxiliary data: country names</span></span></code></pre>
<pre><code><span><span class="co">## Standardizing country names</span></span></code></pre>
<pre><code><span><span class="co">## country found: Argentina</span></span></code></pre>
<pre><code><span><span class="co">## country found: Australia</span></span></code></pre>
<pre><code><span><span class="co">## country found: Belgium</span></span></code></pre>
<pre><code><span><span class="co">## country found: Brazil</span></span></code></pre>
<pre><code><span><span class="co">## country found: Canada</span></span></code></pre>
<pre><code><span><span class="co">## country found: Colombia</span></span></code></pre>
<pre><code><span><span class="co">## country found: Costa Rica</span></span></code></pre>
<pre><code><span><span class="co">## country found: Ecuador</span></span></code></pre>
<pre><code><span><span class="co">## country found: Estonia</span></span></code></pre>
<pre><code><span><span class="co">## country found: Finland</span></span></code></pre>
<pre><code><span><span class="co">## country found: France</span></span></code></pre>
<pre><code><span><span class="co">## country found: Germany</span></span></code></pre>
<pre><code><span><span class="co">## country found: Ireland</span></span></code></pre>
<pre><code><span><span class="co">## country found: Mexico</span></span></code></pre>
<pre><code><span><span class="co">## country found: Norway</span></span></code></pre>
<pre><code><span><span class="co">## country found: South Africa</span></span></code></pre>
<pre><code><span><span class="co">## country found: Sweden</span></span></code></pre>
<pre><code><span><span class="co">## country found: Switzerland</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## bdc_country_standardized:</span></span>
<span><span class="co">## The country names of 5 records were standardized.</span></span>
<span><span class="co">## Two columns ('country_suggested' and 'countryCode') were added to the database.</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="transpcoords">3.7 TranspCoords<a class="anchor" aria-label="anchor" href="#transpcoords"></a>
</h3>
<p>Flag and correct records when <em>decimalLatitude</em> and
<em>decimalLongitude</em> appear to be transposed. We created this
chunked version of <code><a href="https://brunobrr.github.io/bdc/reference/bdc_coordinates_transposed.html" class="external-link">bdc::bdc_coordinates_transposed()</a></code>
because it is very RAM-heavy using our large bee dataset. Like many of
our other ‘jbd_…’ functions there are other improvements - e.g.,
parallel running. NOTE: Usually you would use scale = “large”, which
requires rnaturalearthhires</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/jbd_Ctrans_chunker.html">jbd_Ctrans_chunker</a></span><span class="op">(</span></span>
<span>  <span class="co"># bdc_coordinates_transposed inputs</span></span>
<span>  data <span class="op">=</span> <span class="va">check_pf</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"database_id"</span>,</span>
<span>  lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  lon <span class="op">=</span> <span class="st">"decimalLongitude"</span>,</span>
<span>  country <span class="op">=</span> <span class="st">"country"</span>,</span>
<span>  countryCode <span class="op">=</span> <span class="st">"countryCode"</span>,</span>
<span>  border_buffer <span class="op">=</span> <span class="fl">0.2</span>, <span class="co"># in decimal degrees (~22 km at the equator)</span></span>
<span>  save_outputs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  sci_names <span class="op">=</span> <span class="st">"scientificName"</span>,</span>
<span>  <span class="co"># chunker inputs</span></span>
<span>  stepSize <span class="op">=</span> <span class="fl">1000000</span>,  <span class="co"># How many rows to process at a time</span></span>
<span>  chunkStart <span class="op">=</span> <span class="fl">1</span>,  <span class="co"># Start row</span></span>
<span>  append <span class="op">=</span> <span class="cn">FALSE</span>,  <span class="co"># If FALSE it may overwrite existing dataset</span></span>
<span>    <span class="co"># In a normal run, please use scale = "large"</span></span>
<span>  scale <span class="op">=</span> <span class="st">"medium"</span>,</span>
<span>  path <span class="op">=</span> <span class="va">OutPath_Check</span>,</span>
<span>  mc.cores <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">##  - Running chunker with:</span></span>
<span><span class="co">## stepSize = 1,000,000</span></span>
<span><span class="co">## chunkStart = 1</span></span>
<span><span class="co">## chunkEnd = 1,000,000</span></span>
<span><span class="co">## append = FALSE</span></span>
<span><span class="co">##  - Starting chunk 1...</span></span>
<span><span class="co">## From 1 to 1,000,000</span></span>
<span><span class="co">##  - Cleaning RAM.</span></span>
<span><span class="co">##  - Finished chunk 1 with 1 remaining. Records examined: 205</span></span></code></pre>
<p>Get a quick summary of the number of transposed records.</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">check_pf</span><span class="op">$</span><span class="va">coordinates_transposed</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></span></code></pre></div>
<p>Save the dataset.</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_pf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_excel_csv</a></span><span class="op">(</span><span class="va">.</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">OutPath_Intermediate</span>, <span class="st">"01_prefilter_database.csv"</span>,</span>
<span>                         sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            used  (Mb) gc trigger  (Mb)  max used  (Mb)</span></span>
<span><span class="co">## Ncells  5863618 313.2   10281212 549.1  10281212 549.1</span></span>
<span><span class="co">## Vcells 10794391  82.4   75616456 577.0 109022374 831.8</span></span></code></pre>
<p>Read the data in again if needed.</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"check_pf"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">OutPath_Intermediate</span>, <span class="st">"01_prefilter_database.csv"</span>,</span>
<span>                                    sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="coord-country">3.8 Coord-country<a class="anchor" aria-label="anchor" href="#coord-country"></a>
</h3>
<p>Collect all country names in the <em>country_suggested</em> column.
We rebuilt a <strong>bdc</strong> function to flag occurrences where the
coordinates are inconsistent with the provided country name.</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/jbd_coordCountryInconsistent.html">jbd_coordCountryInconsistent</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">check_pf</span>,</span>
<span>  lon <span class="op">=</span> <span class="st">"decimalLongitude"</span>,</span>
<span>  lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  mapResolution <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  pointBuffer <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  - Downloading naturalearth map...</span></span></code></pre>
<pre><code><span><span class="co">## Spherical geometry (s2) switched off</span></span></code></pre>
<pre><code><span><span class="co">##  - Extracting initial country names without buffer...</span></span></code></pre>
<pre><code><span><span class="co">## although coordinates are longitude/latitude, st_intersects assumes that they</span></span>
<span><span class="co">## are planar</span></span></code></pre>
<pre><code><span><span class="co">## although coordinates are longitude/latitude, st_intersects assumes that they</span></span>
<span><span class="co">## are planar</span></span></code></pre>
<pre><code><span><span class="co">##  - Buffering naturalearth map by pointBuffer...</span></span></code></pre>
<pre><code><span><span class="co">## dist is assumed to be in decimal degrees (arc_degrees).</span></span></code></pre>
<pre><code><span><span class="co">##  - Extracting FAILED country names WITH buffer...</span></span></code></pre>
<pre><code><span><span class="co">## although coordinates are longitude/latitude, st_intersects assumes that they</span></span>
<span><span class="co">## are planar</span></span>
<span><span class="co">## although coordinates are longitude/latitude, st_intersects assumes that they</span></span>
<span><span class="co">## are planar</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## jbd_coordinates_country_inconsistent:</span></span>
<span><span class="co">## Flagged 2 records.</span></span>
<span><span class="co">## The column, '.coordinates_country_inconsistent', was added to the database.</span></span></code></pre>
<pre><code><span><span class="co">##  - Completed in 0.02 secs</span></span></code></pre>
<p>Save the dataset.</p>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_pf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_excel_csv</a></span><span class="op">(</span><span class="va">.</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">OutPath_Intermediate</span>, <span class="st">"01_prefilter_database.csv"</span>,</span>
<span>                         sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="georefissue">3.9 GeoRefIssue<a class="anchor" aria-label="anchor" href="#georefissue"></a>
</h3>
<p>This function identifies records whose coordinates can potentially be
extracted from locality information, which must be manually checked
later.</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xyFromLocality</span> <span class="op">&lt;-</span> <span class="fu">bdc</span><span class="fu">::</span><span class="fu"><a href="https://brunobrr.github.io/bdc/reference/bdc_coordinates_from_locality.html" class="external-link">bdc_coordinates_from_locality</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">check_pf</span>,</span>
<span>  locality <span class="op">=</span> <span class="st">"locality"</span>,</span>
<span>  lon <span class="op">=</span> <span class="st">"decimalLongitude"</span>,</span>
<span>  lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  save_outputs <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="co"># Save data </span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_excel_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">OutPath_Check</span>, <span class="st">"01_coordinates_from_locality.csv"</span>,</span>
<span>                         sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Remove spent data.</p>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">xyFromLocality</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="flag-absent">3.10 Flag Absent<a class="anchor" aria-label="anchor" href="#flag-absent"></a>
</h3>
<p>Flag the records marked as “absent”.</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/flagAbsent.html">flagAbsent</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">check_pf</span>,</span>
<span>                   PresAbs <span class="op">=</span> <span class="st">"occurrenceStatus"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## \.occurrenceAbsent:</span></span>
<span><span class="co">##  Flagged 8 absent records:</span></span>
<span><span class="co">##  One column was added to the database.</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="flag-license">3.11 flag License<a class="anchor" aria-label="anchor" href="#flag-license"></a>
</h3>
<p>Flag the records that may not be used according to their license
information.</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/flagLicense.html">flagLicense</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">check_pf</span>,</span>
<span>                    strings_to_restrict <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>                    <span class="co"># DON'T flag if in the following dataSource(s)</span></span>
<span>                    excludeDataSource <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## \.unLicensed:</span></span>
<span><span class="co">##  Flagged 0 records that may NOT be used.</span></span>
<span><span class="co">##  One column was added to the database.</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="gbif-issue">3.12 GBIF issue<a class="anchor" aria-label="anchor" href="#gbif-issue"></a>
</h3>
<p>Flag select issues that are flagged by GBIF.</p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/GBIFissues.html">GBIFissues</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">check_pf</span>, </span>
<span>                   issueColumn <span class="op">=</span> <span class="st">"issue"</span>, </span>
<span>                   GBIFflags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"COORDINATE_INVALID"</span>, <span class="st">"ZERO_COORDINATE"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">##  - jbd_GBIFissues:</span></span>
<span><span class="co">## Flagged 0 </span></span>
<span><span class="co">##   The .GBIFflags column was added to the database.</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="flag-reports">3.13 Flag Reports<a class="anchor" aria-label="anchor" href="#flag-reports"></a>
</h3>
<div class="section level4">
<h4 id="a--save-flags">a. Save flags<a class="anchor" aria-label="anchor" href="#a--save-flags"></a>
</h4>
<p>Save the flags so far. This function will make sure that you keep a
copy of everything that has been flagged up until now. This will be
updated throughout the script and can accessed at the end, so be wary of
moving files around manually. However, these data will also still be
maintained in the main running file, so this is an optional
fail-safe.</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flagFile</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/flagRecorder.html">flagRecorder</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">check_pf</span>,</span>
<span>  outPath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">OutPath_Report</span>, sep <span class="op">=</span><span class="st">""</span><span class="op">)</span>,</span>
<span>  fileName <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"flagsRecorded_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>,  <span class="st">".csv"</span><span class="op">)</span>,</span>
<span>    <span class="co"># These are the columns that will be kept along with the flags</span></span>
<span>  idColumns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"database_id"</span>, <span class="st">"id"</span>, <span class="st">"catalogNumber"</span>, <span class="st">"occurrenceID"</span>, <span class="st">"dataSource"</span><span class="op">)</span>,</span>
<span>    <span class="co"># TRUE if you want to find a file from a previous part of the script to append to</span></span>
<span>  append <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  - NO .summary column detected. This will added to the data.</span></span></code></pre>
<pre><code><span><span class="co">##  - Data saved to /home/runner/work/BeeBDC/BeeBDC/inst/extdata/WebDir/Data_acquisition_workflow/Output/Report/flagsRecorded_2023-09-01.csv</span></span></code></pre>
<pre><code><span><span class="co">##  - Selected 14 columns. These include:</span></span>
<span><span class="co">## database_id, id, catalogNumber, occurrenceID, dataSource, .scientificName_empty, .coordinates_empty, .coordinates_outOfRange, .basisOfRecords_notStandard, .coordinates_country_inconsistent, .occurrenceAbsent, .unLicensed, .GBIFflags, and .summary</span></span></code></pre>
<p>Update the <em>.summary</em> column</p>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/summaryFun.html">summaryFun</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">check_pf</span>,</span>
<span>    <span class="co"># Don't filter these columns (or NULL)</span></span>
<span>  dontFilterThese <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    <span class="co"># Remove the filtering columns?</span></span>
<span>  removeFilterColumns <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    <span class="co"># Filter to ONLY cleaned data?</span></span>
<span>  filterClean <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  - We will flag all columns starting with '.'</span></span></code></pre>
<pre><code><span><span class="co">##  - summaryFun:</span></span>
<span><span class="co">## Flagged 52 </span></span>
<span><span class="co">##   The .summary column was added to the database.</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="c--reporting">c. Reporting<a class="anchor" aria-label="anchor" href="#c--reporting"></a>
</h4>
<p>Use <strong>bdc</strong> to generate reports.</p>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">report</span> <span class="op">&lt;-</span> <span class="fu">bdc</span><span class="fu">::</span><span class="fu"><a href="https://brunobrr.github.io/bdc/reference/bdc_create_report.html" class="external-link">bdc_create_report</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">check_pf</span>,</span>
<span>                                  database_id <span class="op">=</span> <span class="st">"database_id"</span>,</span>
<span>                                  workflow_step <span class="op">=</span> <span class="st">"prefilter"</span>,</span>
<span>                                  save_report <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="save">3.14 Save<a class="anchor" aria-label="anchor" href="#save"></a>
</h3>
<p>Save the intermediate dataset.</p>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_pf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_excel_csv</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">OutPath_Intermediate</span>, <span class="st">"01_prefilter_output.csv"</span>,</span>
<span>                            sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by James B. Dorey, Robert O’Reilly, Silas Bossert, Erica Fischer.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
