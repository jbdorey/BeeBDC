<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Species richness estimation • BeeBDC</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Species richness estimation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BeeBDC</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Go to package home"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html" aria-label="Function list"><span class="fa fas fa-r"></span> Functions</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-occurrence-cleaning" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Occurrence data cleaning vignettes"><span class="fa fas fa-broom"></span> Occurrence cleaning</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-occurrence-cleaning">
<li><a class="dropdown-item" href="../articles/BeeBDC_main.html">BeeBDC full cleaning workflow</a></li>
    <li><a class="dropdown-item" href="../articles/basic_workflow.html">BeeBDC basic workflow</a></li>
    <li><a class="dropdown-item" href="../articles/dataPrep.html">Bee-specific data preparation</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-species-richness-estimation" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Species richness estimation vignettes"><span class="fa fas fa-arrow-up-right-dots"></span> Species richness estimation</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-species-richness-estimation">
<li><a class="dropdown-item" href="../articles/speciesRichness_example.html">BeeBDC richness estimation</a></li>
    <li><a class="dropdown-item" href="../articles/speciesRichness_example.html#Parallel-estimations">  1.0 Parallel estimation</a></li>
    <li><a class="dropdown-item" href="../articles/speciesRichness_example.html#Estimating-richness-from-the-known-unknowns">  2.0 Estimation with checklists</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="https://jbdorey.github.io/BeeBDC/news/index.html"><span class="fa fas fa-newspaper"></span> News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jbdorey/BeeBDC/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="speciesRichness_example_files/kePrint-0.0.1/kePrint.js"></script><link href="speciesRichness_example_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Species richness estimation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jbdorey/BeeBDC/blob/devel/vignettes/articles/speciesRichness_example.Rmd" class="external-link"><code>vignettes/articles/speciesRichness_example.Rmd</code></a></small>
      <div class="d-none name"><code>speciesRichness_example.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="section">
<a href="https://github.com/jbdorey/BeeBDC" class="external-link"><img src="https://photos.smugmug.com/photos/i-MpLFKTT/0/741daa6d/X4/i-MpLFKTT-X4.png" alt="BeeBDC logo of a cuckoo bee sweeping up occurrence records in South America" align="right" width="155"></a><a class="anchor" aria-label="anchor" href="#section"></a>
</h2>
<p>This is a basic workflow for feeding species occurrence data, a
group’s taxonomy, and a group’s country checklist into BeeBDC in order
to produce species richness estimates. Some of these functions are also
generic wrappers around <code>SpadeR</code> and <code>iNEXT</code>
functions that can be used with any abundance data. These functions have
grown from an <a href="DOI">original publication</a>.</p>
</div>
<div class="section level2">
<h2 id="script-preparation">Script preparation<a class="anchor" aria-label="anchor" href="#script-preparation"></a>
</h2>
<div class="section level3">
<h3 id="working-directory">Working directory<a class="anchor" aria-label="anchor" href="#working-directory"></a>
</h3>
<p>Choose the path to the root folder in which all other folders can be
found.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RootPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"/your/path/here"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create the working directory in the RootPath if it doesn't exist already</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">RootPath</span>, <span class="st">"/Data_acquisition_workflow"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">RootPath</span>, <span class="st">"/Data_acquisition_workflow"</span><span class="op">)</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Set the working directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">RootPath</span>, <span class="st">"/Data_acquisition_workflow"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="install-packages-if-needed">Install packages (if needed)<a class="anchor" aria-label="anchor" href="#install-packages-if-needed"></a>
</h3>
<p>You may need to install some packages for using this workflow. In
particular, <code>SpadeR</code> and <code>iNEXT</code> are required.
They should prompt you to download them the first time that you run the
functions, however, let’s install them here and now.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"SpadeR"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"iNEXT"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="parallel-estimations">Parallel estimations<a class="anchor" aria-label="anchor" href="#parallel-estimations"></a>
</h2>
<p>We can start by looking at the relatively simple <code>iNEXT</code>
and <code>SpadeR</code> wrapper functions that can take the usual inputs
for those functions in their host packages. (See
<code><a href="https://rdrr.io/pkg/iNEXT/man/iNEXT.html" class="external-link">iNEXT::iNEXT()</a></code> and <code><a href="https://rdrr.io/pkg/SpadeR/man/ChaoSpecies.html" class="external-link">SpadeR::ChaoSpecies()</a></code> for
more info.) These functions can take your data and run multiple
sites/countries/whatever level you want to throw at them and run them in
parallel. This greatly simplifies the code needed to run them and also
makes its implementation MUCH faster!</p>
<div class="section level3">
<h3 id="inextwrapper">iNEXTwrapper<a class="anchor" aria-label="anchor" href="#inextwrapper"></a>
</h3>
<p><code><a href="../reference/iNEXTwrapper.html">BeeBDC::iNEXTwrapper()</a></code> parallelizes
<code><a href="https://rdrr.io/pkg/iNEXT/man/iNEXT.html" class="external-link">iNEXT::iNEXT()</a></code>, which estimates species richness patterns
by extrapolating and interpolating Hill numbers. By and large this kinda
equates to estimating richness by rarefaction. We can start by reading
in an example dataset with 1,488
<em>scientificName-country_suggested</em> combinations across four
countries; Fiji, Uganda, Vietnam, and Zambia.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beesCountrySubset</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="va"><a href="../reference/beesCountrySubset.html">beesCountrySubset</a></span></span></code></pre></div>
<p>Next, let’s look at how we would usually use iNEXT… By first
transforming our <em>(very simple example)</em> occurrence dataset into
the right format and then running the function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Transform the data</span></span>
<span><span class="va">transformedAbundance</span> <span class="op">&lt;-</span> <span class="va">beesCountrySubset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">scientificName</span>, <span class="va">country_suggested</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">scientificName</span>, <span class="va">country_suggested</span>, <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">country_suggested</span>, values_from <span class="op">=</span> <span class="va">n</span>, values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co"># Create the rownames</span></span>
<span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">column_to_rownames</a></span><span class="op">(</span><span class="st">"scientificName"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Run iNEXT</span></span>
<span><span class="va">output_iNEXT</span> <span class="op">&lt;-</span> <span class="fu">iNEXT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/iNEXT/man/iNEXT.html" class="external-link">iNEXT</a></span><span class="op">(</span><span class="va">transformedAbundance</span>, datatype <span class="op">=</span> <span class="st">"abundance"</span><span class="op">)</span></span></code></pre></div>
<p>We can also view the output of this function by running
<code>output_iNEXT$AsyEst</code></p>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:350px; ">
<table class="table  lightable-material lightable-striped lightable-hover table table-responsive" style='font-family: "Source Sans Pro", helvetica, sans-serif; margin-left: auto; margin-right: auto; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead><tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Assemblage
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Diversity
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Observed
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Estimator
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
s.e.
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
LCL
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
UCL
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Fiji
</td>
<td style="text-align:left;">
Species richness
</td>
<td style="text-align:right;">
17.000000
</td>
<td style="text-align:right;">
17.499483
</td>
<td style="text-align:right;">
1.4850098
</td>
<td style="text-align:right;">
17.000000
</td>
<td style="text-align:right;">
20.410049
</td>
</tr>
<tr>
<td style="text-align:left;">
Fiji
</td>
<td style="text-align:left;">
Shannon diversity
</td>
<td style="text-align:right;">
4.712056
</td>
<td style="text-align:right;">
4.754101
</td>
<td style="text-align:right;">
0.2164397
</td>
<td style="text-align:right;">
4.329887
</td>
<td style="text-align:right;">
5.178315
</td>
</tr>
<tr>
<td style="text-align:left;">
Fiji
</td>
<td style="text-align:left;">
Simpson diversity
</td>
<td style="text-align:right;">
2.653013
</td>
<td style="text-align:right;">
2.657561
</td>
<td style="text-align:right;">
0.1237356
</td>
<td style="text-align:right;">
2.415044
</td>
<td style="text-align:right;">
2.900078
</td>
</tr>
<tr>
<td style="text-align:left;">
Uganda
</td>
<td style="text-align:left;">
Species richness
</td>
<td style="text-align:right;">
44.000000
</td>
<td style="text-align:right;">
70.243359
</td>
<td style="text-align:right;">
14.1752423
</td>
<td style="text-align:right;">
44.000000
</td>
<td style="text-align:right;">
98.026324
</td>
</tr>
<tr>
<td style="text-align:left;">
Uganda
</td>
<td style="text-align:left;">
Shannon diversity
</td>
<td style="text-align:right;">
19.651483
</td>
<td style="text-align:right;">
26.633143
</td>
<td style="text-align:right;">
3.4844763
</td>
<td style="text-align:right;">
19.803695
</td>
<td style="text-align:right;">
33.462591
</td>
</tr>
<tr>
<td style="text-align:left;">
Uganda
</td>
<td style="text-align:left;">
Simpson diversity
</td>
<td style="text-align:right;">
7.699248
</td>
<td style="text-align:right;">
8.128000
</td>
<td style="text-align:right;">
1.5689856
</td>
<td style="text-align:right;">
5.052845
</td>
<td style="text-align:right;">
11.203155
</td>
</tr>
<tr>
<td style="text-align:left;">
Vietnam
</td>
<td style="text-align:left;">
Species richness
</td>
<td style="text-align:right;">
6.000000
</td>
<td style="text-align:right;">
13.794872
</td>
<td style="text-align:right;">
5.8924098
</td>
<td style="text-align:right;">
6.000000
</td>
<td style="text-align:right;">
25.343783
</td>
</tr>
<tr>
<td style="text-align:left;">
Vietnam
</td>
<td style="text-align:left;">
Shannon diversity
</td>
<td style="text-align:right;">
1.953128
</td>
<td style="text-align:right;">
2.307552
</td>
<td style="text-align:right;">
0.5923478
</td>
<td style="text-align:right;">
1.146572
</td>
<td style="text-align:right;">
3.468532
</td>
</tr>
<tr>
<td style="text-align:left;">
Vietnam
</td>
<td style="text-align:left;">
Simpson diversity
</td>
<td style="text-align:right;">
1.386509
</td>
<td style="text-align:right;">
1.400756
</td>
<td style="text-align:right;">
0.1986146
</td>
<td style="text-align:right;">
1.011479
</td>
<td style="text-align:right;">
1.790034
</td>
</tr>
<tr>
<td style="text-align:left;">
Zambia
</td>
<td style="text-align:left;">
Species richness
</td>
<td style="text-align:right;">
129.000000
</td>
<td style="text-align:right;">
186.853965
</td>
<td style="text-align:right;">
17.7824798
</td>
<td style="text-align:right;">
152.000945
</td>
<td style="text-align:right;">
221.706985
</td>
</tr>
<tr>
<td style="text-align:left;">
Zambia
</td>
<td style="text-align:left;">
Shannon diversity
</td>
<td style="text-align:right;">
77.832700
</td>
<td style="text-align:right;">
104.647375
</td>
<td style="text-align:right;">
7.6001195
</td>
<td style="text-align:right;">
89.751415
</td>
<td style="text-align:right;">
119.543336
</td>
</tr>
<tr>
<td style="text-align:left;">
Zambia
</td>
<td style="text-align:left;">
Simpson diversity
</td>
<td style="text-align:right;">
32.753790
</td>
<td style="text-align:right;">
35.991359
</td>
<td style="text-align:right;">
6.3494595
</td>
<td style="text-align:right;">
23.546647
</td>
<td style="text-align:right;">
48.436071
</td>
</tr>
</tbody>
</table>
</div>
<p>The implementation of <code><a href="../reference/iNEXTwrapper.html">BeeBDC::iNEXTwrapper()</a></code> is also
relatively simple; including the implementation of running in parallel
(<strong>Note: Windows machines can’t use R’s parallel
functions</strong>). We can again modify the input data to work with the
function as below and we could leave most of the inputs to iNEXTwrapper
to the defaults or change them as we saw fit. The key variable is to
change <code>mc.cores</code> to however many threads you’d liek to use
on your computer!</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Transform data</span></span>
<span><span class="va">data_nextWrapper</span> <span class="op">&lt;-</span> <span class="va">beesCountrySubset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">scientificName</span>, <span class="va">country_suggested</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate iNEXT with the wrapper function</span></span>
<span><span class="va">output_iNEXTwrapper</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/iNEXTwrapper.html">iNEXTwrapper</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_nextWrapper</span>, variableColumn <span class="op">=</span> <span class="st">"country_suggested"</span>,</span>
<span>    valueColumn <span class="op">=</span> <span class="st">"n"</span>, q <span class="op">=</span> <span class="fl">0</span>, datatype <span class="op">=</span> <span class="st">"abundance"</span>, conf <span class="op">=</span> <span class="fl">0.95</span>, se <span class="op">=</span> <span class="cn">TRUE</span>, nboot <span class="op">=</span> <span class="fl">50</span>,</span>
<span>    size <span class="op">=</span> <span class="cn">NULL</span>, endpoint <span class="op">=</span> <span class="cn">NULL</span>, knots <span class="op">=</span> <span class="fl">40</span>, mc.cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  - Outputs can be found in a list with two tibbles called 'DataInfo' and 'AsyEst' and a list of iNext outputs per groupVariable in iNextEst'.</span></span></code></pre>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:350px; ">
<table class="table  lightable-material lightable-striped lightable-hover table table-responsive" style='font-family: "Source Sans Pro", helvetica, sans-serif; margin-left: auto; margin-right: auto; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead><tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
country_suggested
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
statistic
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Observed
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Estimator
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Est_s.e.
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
95% Lower
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
95% Upper
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Fiji
</td>
<td style="text-align:left;">
Species Richness
</td>
<td style="text-align:right;">
17.000000
</td>
<td style="text-align:right;">
17.499483
</td>
<td style="text-align:right;">
1.6650163
</td>
<td style="text-align:right;">
14.236111
</td>
<td style="text-align:right;">
20.762855
</td>
</tr>
<tr>
<td style="text-align:left;">
Fiji
</td>
<td style="text-align:left;">
Shannon diversity
</td>
<td style="text-align:right;">
4.712056
</td>
<td style="text-align:right;">
4.754101
</td>
<td style="text-align:right;">
0.2271829
</td>
<td style="text-align:right;">
4.308831
</td>
<td style="text-align:right;">
5.199372
</td>
</tr>
<tr>
<td style="text-align:left;">
Fiji
</td>
<td style="text-align:left;">
Simpson diversity
</td>
<td style="text-align:right;">
2.653013
</td>
<td style="text-align:right;">
2.657561
</td>
<td style="text-align:right;">
0.1264695
</td>
<td style="text-align:right;">
2.409685
</td>
<td style="text-align:right;">
2.905436
</td>
</tr>
<tr>
<td style="text-align:left;">
Uganda
</td>
<td style="text-align:left;">
Species Richness
</td>
<td style="text-align:right;">
44.000000
</td>
<td style="text-align:right;">
70.243359
</td>
<td style="text-align:right;">
25.7541584
</td>
<td style="text-align:right;">
19.766137
</td>
<td style="text-align:right;">
120.720582
</td>
</tr>
<tr>
<td style="text-align:left;">
Uganda
</td>
<td style="text-align:left;">
Shannon diversity
</td>
<td style="text-align:right;">
19.651483
</td>
<td style="text-align:right;">
26.633143
</td>
<td style="text-align:right;">
4.2573468
</td>
<td style="text-align:right;">
18.288896
</td>
<td style="text-align:right;">
34.977389
</td>
</tr>
<tr>
<td style="text-align:left;">
Uganda
</td>
<td style="text-align:left;">
Simpson diversity
</td>
<td style="text-align:right;">
7.699248
</td>
<td style="text-align:right;">
8.128000
</td>
<td style="text-align:right;">
1.8631187
</td>
<td style="text-align:right;">
4.476354
</td>
<td style="text-align:right;">
11.779646
</td>
</tr>
<tr>
<td style="text-align:left;">
Vietnam
</td>
<td style="text-align:left;">
Species Richness
</td>
<td style="text-align:right;">
6.000000
</td>
<td style="text-align:right;">
13.794872
</td>
<td style="text-align:right;">
6.1393736
</td>
<td style="text-align:right;">
1.761921
</td>
<td style="text-align:right;">
25.827823
</td>
</tr>
<tr>
<td style="text-align:left;">
Vietnam
</td>
<td style="text-align:left;">
Shannon diversity
</td>
<td style="text-align:right;">
1.953128
</td>
<td style="text-align:right;">
2.307552
</td>
<td style="text-align:right;">
0.5633747
</td>
<td style="text-align:right;">
1.203358
</td>
<td style="text-align:right;">
3.411746
</td>
</tr>
<tr>
<td style="text-align:left;">
Vietnam
</td>
<td style="text-align:left;">
Simpson diversity
</td>
<td style="text-align:right;">
1.386509
</td>
<td style="text-align:right;">
1.400756
</td>
<td style="text-align:right;">
0.1830418
</td>
<td style="text-align:right;">
1.042001
</td>
<td style="text-align:right;">
1.759511
</td>
</tr>
<tr>
<td style="text-align:left;">
Zambia
</td>
<td style="text-align:left;">
Species Richness
</td>
<td style="text-align:right;">
129.000000
</td>
<td style="text-align:right;">
186.853965
</td>
<td style="text-align:right;">
18.1990609
</td>
<td style="text-align:right;">
151.184461
</td>
<td style="text-align:right;">
222.523469
</td>
</tr>
<tr>
<td style="text-align:left;">
Zambia
</td>
<td style="text-align:left;">
Shannon diversity
</td>
<td style="text-align:right;">
77.832700
</td>
<td style="text-align:right;">
104.647375
</td>
<td style="text-align:right;">
6.8285323
</td>
<td style="text-align:right;">
91.263698
</td>
<td style="text-align:right;">
118.031053
</td>
</tr>
<tr>
<td style="text-align:left;">
Zambia
</td>
<td style="text-align:left;">
Simpson diversity
</td>
<td style="text-align:right;">
32.753790
</td>
<td style="text-align:right;">
35.991359
</td>
<td style="text-align:right;">
5.5923079
</td>
<td style="text-align:right;">
25.030637
</td>
<td style="text-align:right;">
46.952081
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="chaowrapper">ChaoWrapper<a class="anchor" aria-label="anchor" href="#chaowrapper"></a>
</h3>
<p><code><a href="../reference/ChaoWrapper.html">BeeBDC::ChaoWrapper()</a></code> parallelizes
<code><a href="https://rdrr.io/pkg/SpadeR/man/ChaoSpecies.html" class="external-link">SpadeR::ChaoSpecies()</a></code>, which estimates species richness
using various non-parametric estimators. The primary one that I tend to
use is iChao. Let’s use the same example dataset to first run the
<strong>SpadeR</strong> function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Transform data</span></span>
<span><span class="va">data_iChao</span> <span class="op">&lt;-</span> <span class="va">beesCountrySubset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">scientificName</span>, <span class="va">country_suggested</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">scientificName</span>, <span class="va">country_suggested</span>, <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">country_suggested</span>, values_from <span class="op">=</span> <span class="va">n</span>, values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co"># Create the rownames</span></span>
<span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">column_to_rownames</a></span><span class="op">(</span><span class="st">"scientificName"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run ChaoSpecies for the country Fiji</span></span>
<span><span class="va">output_iChao</span> <span class="op">&lt;-</span> <span class="fu">SpadeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SpadeR/man/ChaoSpecies.html" class="external-link">ChaoSpecies</a></span><span class="op">(</span><span class="va">data_iChao</span><span class="op">$</span><span class="va">Fiji</span>, datatype <span class="op">=</span> <span class="st">"abundance"</span><span class="op">)</span></span></code></pre></div>
<p>Let’s view the output of this function by running
<code>output_iChao$Species_table</code>. Once again, you’ll be able to
see that there are actually quite a few species richness estimators
available here.</p>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:350px; ">
<table class="table  lightable-material lightable-striped lightable-hover table table-responsive" style='font-family: "Source Sans Pro", helvetica, sans-serif; margin-left: auto; margin-right: auto; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead><tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Estimate
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
s.e.
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
95%Lower
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
95%Upper
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Homogeneous Model
</td>
<td style="text-align:right;">
17.182
</td>
<td style="text-align:right;">
0.474
</td>
<td style="text-align:right;">
17.011
</td>
<td style="text-align:right;">
20.015
</td>
</tr>
<tr>
<td style="text-align:left;">
Homogeneous (MLE)
</td>
<td style="text-align:right;">
17.000
</td>
<td style="text-align:right;">
0.633
</td>
<td style="text-align:right;">
17.000
</td>
<td style="text-align:right;">
18.858
</td>
</tr>
<tr>
<td style="text-align:left;">
Chao1 (Chao, 1984)
</td>
<td style="text-align:right;">
17.499
</td>
<td style="text-align:right;">
1.322
</td>
<td style="text-align:right;">
17.030
</td>
<td style="text-align:right;">
25.434
</td>
</tr>
<tr>
<td style="text-align:left;">
Chao1-bc
</td>
<td style="text-align:right;">
17.000
</td>
<td style="text-align:right;">
0.633
</td>
<td style="text-align:right;">
17.000
</td>
<td style="text-align:right;">
18.858
</td>
</tr>
<tr>
<td style="text-align:left;">
iChao1 (Chiu et al. 2014)
</td>
<td style="text-align:right;">
17.624
</td>
<td style="text-align:right;">
1.322
</td>
<td style="text-align:right;">
17.048
</td>
<td style="text-align:right;">
25.048
</td>
</tr>
<tr>
<td style="text-align:left;">
ACE (Chao &amp; Lee, 1992)
</td>
<td style="text-align:right;">
17.342
</td>
<td style="text-align:right;">
0.775
</td>
<td style="text-align:right;">
17.024
</td>
<td style="text-align:right;">
21.788
</td>
</tr>
<tr>
<td style="text-align:left;">
ACE-1 (Chao &amp; Lee, 1992)
</td>
<td style="text-align:right;">
17.366
</td>
<td style="text-align:right;">
0.835
</td>
<td style="text-align:right;">
17.026
</td>
<td style="text-align:right;">
22.168
</td>
</tr>
<tr>
<td style="text-align:left;">
1st order jackknife
</td>
<td style="text-align:right;">
17.999
</td>
<td style="text-align:right;">
1.413
</td>
<td style="text-align:right;">
17.128
</td>
<td style="text-align:right;">
24.796
</td>
</tr>
<tr>
<td style="text-align:left;">
2nd order jackknife
</td>
<td style="text-align:right;">
18.000
</td>
<td style="text-align:right;">
2.446
</td>
<td style="text-align:right;">
17.065
</td>
<td style="text-align:right;">
32.367
</td>
</tr>
</tbody>
</table>
</div>
<p>The implementation of the parallel wrapper is also quite simple for
<code><a href="../reference/ChaoWrapper.html">BeeBDC::ChaoWrapper()</a></code>. And the number of cores can also be
changed using the <code>mc.cores</code> argument. Note, that in this
case, we can run all sites (or countries) at once!</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the wrapper function</span></span>
<span><span class="va">output_iChaowrapper</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/ChaoWrapper.html">ChaoWrapper</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_iChao</span>, datatype <span class="op">=</span> <span class="st">"abundance"</span>,</span>
<span>    k <span class="op">=</span> <span class="fl">10</span>, conf <span class="op">=</span> <span class="fl">0.95</span>, mc.cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  - Outputs can be found in a list with two tibbles called 'basicTable' and 'richnessTable'.</span></span></code></pre>
<p>View the output with
<code>output_iChaowrapper$diversityTable</code>.</p>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:350px; ">
<table class="table  lightable-material lightable-striped lightable-hover table table-responsive" style='font-family: "Source Sans Pro", helvetica, sans-serif; margin-left: auto; margin-right: auto; width: auto !important; margin-left: auto; margin-right: auto;'><tbody><tr></tr></tbody></table>
</div>
</div>
<div class="section level3">
<h3 id="visualising">Visualising<a class="anchor" aria-label="anchor" href="#visualising"></a>
</h3>
<p>These are both easy and simple to use wrapper functions. However, the
complexity of the output data types can actually be a little bit
confusing to work with. Especially if you want to visualise those data.
So, we also provide the function,
<code><a href="../reference/ggRichnessWrapper.html">BeeBDC::ggRichnessWrapper()</a></code> to display the results of both
wrapper functions by site. Not only does this functino save a plot that
visualises the data (below), it also outputs a summary of the
estimates.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_summary</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/ggRichnessWrapper.html">ggRichnessWrapper</a></span><span class="op">(</span>iNEXT_in <span class="op">=</span> <span class="va">output_iNEXTwrapper</span>, iChao_in <span class="op">=</span> <span class="va">output_iChaowrapper</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">2</span>, labels <span class="op">=</span> <span class="cn">NULL</span>, fileName <span class="op">=</span> <span class="st">"speciesRichnessPlots"</span>, outPath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    base_width <span class="op">=</span> <span class="fl">8.3</span>, base_height <span class="op">=</span> <span class="fl">11.7</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required namespace: cowplot</span></span></code></pre>
<pre><code><span><span class="co">## Error in UseMethod("filter"): no applicable method for 'filter' applied to an object of class "NULL"</span></span></code></pre>
<p>Note that Fiji’s diversity seems to be reaching asymptote, but the
remaining country’s species richnesses are still climbing. Vietnam in
particular has a huge amount of uncertainty with the iChao estimates
(green) reaching over 60 species! We knew that this was a really small
dataset (in fact we chose it as a test dataset because it is small), but
it goes to show that if your data are inadequate you may not get a great
answer. On the plus side, the 95% confidence intervals all overlap.</p>
<pre><code><span><span class="co">## Error: object 'plot_summary' not found</span></span></code></pre>
<p>You can see, that these functions are moving towards simplifying
quick and mass-estimation of species richness across sites or countries!
The is the idea behind these improvements. But, we take this further
below by also attempting to sample known taxa that are otherwise missing
from our datasets!</p>
</div>
</div>
<div class="section level2">
<h2 id="estimating-richness-from-the-known-unknowns">Estimating richness from the known unknowns<a class="anchor" aria-label="anchor" href="#estimating-richness-from-the-known-unknowns"></a>
</h2>
<p>Seems like a bit of an odd title, no? Well, many taxa have
country-level checklists. Even insect taxa can be well represented in
global country-level checklists; for example, <a href="https://www.antwiki.org/wiki/Welcome_to_AntWiki" class="external-link">ants</a>, <a href="https://doi.org/10.1111/geb.13475" class="external-link">butterflies</a>, <a href="https://doi.org/10.1111/jbi.14457" class="external-link">dragonflies</a>, and <a href="https://www.discoverlife.org/mp/20q?guide=Apoidea_species&amp;flags=HAS:" class="external-link">bees</a>.
While for vertebrates the situation is even better. Country-level global
checklists often incorporate knowledge that isn’t contianed in species
occurrence datasets but that, perhaps, we can take advantage of.</p>
<div class="section level3">
<h3 id="preparing-the-inputs">Preparing the inputs<a class="anchor" aria-label="anchor" href="#preparing-the-inputs"></a>
</h3>
<p>In our <a href="DOI">bee species richness estimates paper</a>, we had
4,819 species (from a total of ~21,000 species) that had no occurrence
records globally. We could have run the above species richness estimates
using just the occurrences that we had, but we wanted to incorporate
that knowledge in our estimates. To do so, we found the samples sizes
from most-recent literature for 497 species and generated a curve (we
also generated this curve using the global- and country-level occurrence
datasets and found the former to match the literature curve well).</p>
<div class="float">
<img src="https://photos.smugmug.com/photos/i-sXCctD2/0/NCPsSsmb4PSncqxVGkkC9SSSdv99NNQFN2rx6q6rn/O/i-sXCctD2.png" width="400" alt="Curves generated using 497 literature species (yellow), the global occurrence records (light blue), and occurrences at the country-level (dark blue)."><div class="figcaption"><em>Curves generated using 497 literature
species (yellow), the global occurrence records (light blue), and
occurrences at the country-level (dark blue).</em></div>
</div>
<p>We can then extract the formula from this curve and use it to
randomly generate data for those missing species. These curves can be
built using your own data; see section 1.6 of the R code for the <a href="DOI">bee species richness estimates paper</a>, which uses
<strong>ggplot2</strong> and <strong>mosaic</strong>’s
<code>fitModel</code> function to generate the curve function that goes
into <code>BeeBDC::diversityPrepR()</code> below.</p>
<p>Let’s dig in… To start with, we will <em>make an R object</em> using
our occurrence data (<em>beesCountrySubset</em>), taxonomy (from
<code><a href="../reference/beesTaxonomy.html">BeeBDC::beesTaxonomy()</a></code> or
<code><a href="../reference/taxadbToBeeBDC.html">BeeBDC::taxadbToBeeBDC()</a></code>), and country
checklist(<code><a href="../reference/beesChecklist.html">BeeBDC::beesChecklist()</a></code> or a manually-made
checklist with the countries in the <em>rNaturalEarth_name</em> column
and species in the <em>validName</em> column; the latter must match the
remaining data — see <code>BeeBDC::HarmoniseR()</code>). Feel free to
explore the input files or the output list of files for modifying your
own and pay attention to match the column names.</p>
<p>Note as well that the <code>curveFunction</code> is the one generated
from the Literature curve above.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># Generate the R file</span></span>
<span><span class="va">estimateData</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu">diversityPrepR</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">beesCountrySubset</span>,</span>
<span>    <span class="co"># Download the bee taxonomy. Download other taxonomies using BeeBDC::taxadbToBeeBDC()</span></span>
<span>  taxonomyFile <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/beesTaxonomy.html">beesTaxonomy</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="co"># Download the bee country checklist. See notes above about making a checklist for other taxa</span></span>
<span>  checklistFile <span class="op">=</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/beesChecklist.html">beesChecklist</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  curveFunction <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">(</span><span class="fl">228.7531</span> <span class="op">*</span> <span class="va">x</span> <span class="op">*</span> <span class="va">x</span><span class="op">^</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">12.1593</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sampleSize <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  countryColumn <span class="op">=</span> <span class="st">"country_suggested"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: 'diversityPrepR' is not an exported object from 'namespace:BeeBDC'</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="making-estimates">Making estimates<a class="anchor" aria-label="anchor" href="#making-estimates"></a>
</h3>
<p>The output file from the above code is then used to feed into the
<code>BeeBDC::richnessEstimator()</code> function which will repeatedly
sample the provided curve and estimate species richness (a user-defined
number of times) at the country (<em>or site</em>), continental, or
global level. This function can also be run in parallel and run at
whatever scale the user asks for. If <code>globalSamples</code>,
<code>continentSamples</code>, or <code>countrySamples</code> are set to
zero, they will not be run. If they are set to &gt;0, they will be
estimated that many times. Let’s run our estimates at the country
(<em>or site</em>) level ten times below, drawing sample sizes from the
non-occurrence species each time (<em>capped at the maximum sample size
for each country</em>).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu">BeeBDC</span><span class="fu">::</span><span class="fu"><a href="../reference/richnessEstimateR.html">richnessEstimateR</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">estimateData</span>,</span>
<span>  sampleSize <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  globalSamples <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  continentSamples <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  countrySamples <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    <span class="co"># Increase the number of cores to use R's parallel package and speed estimates up.</span></span>
<span>  mc.cores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    <span class="co"># Directory where to save files</span></span>
<span>  outPath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  fileName <span class="op">=</span> <span class="st">"Sampled.pdf"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: object 'estimateData' not found</span></span></code></pre>
<p>We can look at the median outputs of our analysis with
<code>estimates$Summary</code>.</p>
<pre><code><span><span class="co">## Error: object 'estimates' not found</span></span></code></pre>
<p>Or, we can look at the outputs from each iteration together with
<code>estimates$SiteOutput</code>.</p>
<pre><code><span><span class="co">## Error: object 'estimates' not found</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="visualising-estimates">Visualising estimates<a class="anchor" aria-label="anchor" href="#visualising-estimates"></a>
</h3>
<p>Of course, these values are super helpful for papers on these topics.
But similarly, we can easily make some further useful
visualisations!</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># To build the manual legend, make a small fake dataset</span></span>
<span><span class="va">legendData</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yes"</span>,<span class="st">"yes"</span><span class="op">)</span>,</span>
<span>                                              statistic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iChao"</span>, <span class="st">"iNEXT"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                                                <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iChao"</span>, <span class="st">"iNEXT"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                              est <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Build a legend manually</span></span>
<span><span class="va">violinLegend</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">legendData</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">name</span>, y <span class="op">=</span> <span class="va">est</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">legendData</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">est</span>, x <span class="op">=</span> <span class="va">name</span>, colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>   <span class="fu">scale_color_manual</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Observed'</span><span class="op">)</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'grey30'</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span></span>
<span>   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">statistic</span>, y <span class="op">=</span> <span class="va">est</span><span class="op">)</span>, position <span class="op">=</span> <span class="fu">position_dodge</span><span class="op">(</span><span class="fl">0.90</span><span class="op">)</span>,  </span>
<span>                     stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Statistic"</span>,</span>
<span>                              labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iChao"</span>, <span class="st">"iNEXT"</span><span class="op">)</span>,</span>
<span>                              values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iChao"</span> <span class="op">=</span> <span class="st">"#55AD9B"</span>, <span class="st">"iNEXT"</span> <span class="op">=</span> <span class="st">"#FD9B63"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">theme</span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">'right'</span>, </span>
<span>         legend.margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, legend.spacing.y <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0</span>, <span class="st">"pt"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>, reverse <span class="op">=</span> <span class="cn">TRUE</span>, order <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the countries </span></span>
<span><span class="va">violinPlot</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">$</span><span class="va">SiteOutput</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">name</span>, y <span class="op">=</span> <span class="va">est</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span>position<span class="op">=</span><span class="st">"dodge"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">Name</span>, </span>
<span>                                                                  y<span class="op">=</span><span class="va">`95%Lower`</span>, x<span class="op">=</span><span class="va">variable</span><span class="op">)</span>, </span>
<span>                        colour <span class="op">=</span>  <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span>position<span class="op">=</span><span class="st">"dodge"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">Name</span>, y<span class="op">=</span><span class="va">`95%Upper`</span>,</span>
<span>                                                                  x<span class="op">=</span><span class="va">variable</span><span class="op">)</span>, colour <span class="op">=</span>  <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span>position<span class="op">=</span><span class="st">"dodge"</span>, alpha<span class="op">=</span><span class="fl">1</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">Name</span>, y<span class="op">=</span><span class="va">Estimate</span>, </span>
<span>                                                                x<span class="op">=</span><span class="va">variable</span><span class="op">)</span>, colour <span class="op">=</span>  <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#55AD9B"</span>, <span class="st">"#FD9B63"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">estimates</span><span class="op">$</span><span class="va">SiteOutput</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">variable</span>, <span class="va">Observed</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                          <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html" class="external-link">drop_na</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                        <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">variable</span>, y <span class="op">=</span> <span class="va">Observed</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"grey40"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Continent"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Species estimate"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill<span class="op">=</span><span class="fu">guide_legend</span><span class="op">(</span>title<span class="op">=</span><span class="st">"Statistic"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>, </span>
<span>                 axis.text.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">60</span>, vjust <span class="op">=</span> <span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html" class="external-link">annotation_custom</a></span><span class="op">(</span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html" class="external-link">ggdraw</a></span><span class="op">(</span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/get_legend.html" class="external-link">get_legend</a></span><span class="op">(</span><span class="va">violinLegend</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                               <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html" class="external-link">ggplotGrob</a></span><span class="op">(</span><span class="op">)</span>, xmin <span class="op">=</span> <span class="fl">1</span>, xmax <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                               ymin <span class="op">=</span> <span class="fl">350</span>, ymax <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: object 'estimates' not found</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co">## Tip: You can wrap the entire ggplot2 chunk of code in brackets () to print at the same time</span></span>
<span></span>
<span><span class="co"># Save the plot</span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/save_plot.html" class="external-link">save_plot</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/violinPlot.pdf"</span><span class="op">)</span>,</span>
<span>                   plot <span class="op">=</span> <span class="va">violinPlot</span>,</span>
<span>                   base_width <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                   base_height <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: object 'violinPlot' not found</span></span></code></pre>
<p>There are many ways to plot or analyse these kinds of data. The rest
I will leave up to you! But, for more ideas, do feel free to check out
the <a href="https://doi.org/10.21203/rs.3.rs-6372769/v1" class="external-link">original
publication</a> for this workflow as well as the <a href="LINK?">original R workflow</a> itself.</p>
</div>
</div>
<div class="section level2">
<h2 id="read-more">Read more<a class="anchor" aria-label="anchor" href="#read-more"></a>
</h2>
<p>You can read more about the implementation of this work in the
original citation: <em>Dorey J. B., Gilpin, A.-M., Johnson, N.,
Esquerre, D., Hughes, A. C., Ascher, J. S., &amp; Orr, M. C. (Under
review). How many bee species are there? A quantitative global estimate.
Nature Communications. <a href="https://doi.org/10.21203/rs.3.rs-6372769/v1" class="external-link uri">https://doi.org/10.21203/rs.3.rs-6372769/v1</a></em></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by James B. Dorey, Robert L. O’Reilly, Silas Bossert, Erica E. Fischer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
